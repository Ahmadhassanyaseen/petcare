[{"filePath":"D:\\fiver_projects\\petcare\\app\\admin\\packages\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\admin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\admin\\plans\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\admin\\packages\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":11,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":27,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":43,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":65,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport MinutePackage from \"@/models/MinutePackage\";\r\nimport { auth } from \"@/lib/auth\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    await connectToDatabase();\r\n    const packages = await MinutePackage.find({}).sort({ price: 1 });\r\n    return NextResponse.json(packages);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to fetch packages\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session || session.user?.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    await connectToDatabase();\r\n    const pkg = await MinutePackage.create(body);\r\n    return NextResponse.json(pkg);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to create package\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session || session.user?.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { _id, ...updateData } = await req.json();\r\n    await connectToDatabase();\r\n    const pkg = await MinutePackage.findByIdAndUpdate(_id, updateData, { new: true });\r\n    return NextResponse.json(pkg);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to update package\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session || session.user?.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n    }\r\n\r\n    await connectToDatabase();\r\n    await MinutePackage.findByIdAndDelete(id);\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to delete package\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\admin\\plans\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":11,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":27,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":43,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":65,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Plan from \"@/models/Plan\";\r\nimport { auth } from \"@/lib/auth\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    await connectToDatabase();\r\n    const plans = await Plan.find({}).sort({ price: 1 });\r\n    return NextResponse.json(plans);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to fetch plans\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session || session.user?.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    await connectToDatabase();\r\n    const plan = await Plan.create(body);\r\n    return NextResponse.json(plan);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to create plan\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session || session.user?.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { _id, ...updateData } = await req.json();\r\n    await connectToDatabase();\r\n    const plan = await Plan.findByIdAndUpdate(_id, updateData, { new: true });\r\n    return NextResponse.json(plan);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to update plan\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session || session.user?.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n    }\r\n\r\n    await connectToDatabase();\r\n    await Plan.findByIdAndDelete(id);\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to delete plan\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\auth\\[...nextauth]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\auth\\register\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1375,1378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1375,1378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport User from \"@/models/Users\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { email, password, name } = await req.json();\r\n\r\n    if (!email || !password) {\r\n      return NextResponse.json(\r\n        { error: \"Email and password are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Check if user already exists\r\n    const existingUser = await User.findOne({ \r\n      email: email.toLowerCase() \r\n    });\r\n\r\n    if (existingUser) {\r\n      return NextResponse.json(\r\n        { error: \"User with this email already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Hash password\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n    // Create new user\r\n    const newUser = await User.create({\r\n      email: email.toLowerCase(),\r\n      password: hashedPassword,\r\n      name: name || undefined,\r\n      total_time: 0,\r\n    });\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        message: \"User registered successfully\",\r\n        user: {\r\n          id: newUser._id.toString(),\r\n          email: newUser.email,\r\n          name: newUser.name,\r\n        },\r\n      },\r\n      { status: 201 }\r\n    );\r\n  } catch (error: any) {\r\n    console.error(\"Registration error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Registration failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\chat\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\chat\\all_sessions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\chat\\save\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1617,1620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1617,1620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport Chat from \"@/models/Chat\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport { auth } from \"@/lib/auth\";\r\n// import { IMessage } from \"@/types\";\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { sessionId, userId, message, role } = await request.json();\r\n\r\n    console.log(\"sessionId\", sessionId);\r\n    console.log(\"userId\", userId);\r\n    console.log(\"message\", message);\r\n    console.log(\"role\", role);\r\n\r\n    if (!sessionId || !userId || !message || !role) {\r\n      return NextResponse.json(\r\n        { error: \"Missing required fields: sessionId, userId, message, role\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!['user', 'assistant'].includes(role)) {\r\n      return NextResponse.json(\r\n        { error: \"Role must be either 'user' or 'assistant'\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const session = await auth();\r\n    if (!session || session.user?.id !== userId) {\r\n      return NextResponse.json(\r\n        { error: \"Unauthorized\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Find existing chat or create new one\r\n    let chat = await Chat.findOne({ sessionId });\r\n\r\n    if (!chat) {\r\n      chat = new Chat({\r\n        sessionId,\r\n        userId,\r\n        messages: []\r\n      });\r\n    } else if (!chat.userId) {\r\n      // Update existing chat without userId to include the current user's ID\r\n      chat.userId = userId;\r\n    }\r\n\r\n    // Add new message\r\n    chat.messages.push({\r\n      role,\r\n      content: message,\r\n      timestamp: new Date()\r\n    } as any);\r\n\r\n    await chat.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Message saved successfully\",\r\n      chatId: chat._id\r\n    });\r\n\r\n  } catch (err) {\r\n    console.error(\"/api/chat/save error\", err);\r\n    return NextResponse.json(\r\n      { error: \"Failed to save message\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\minutes\\purchased\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6835,6838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6835,6838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport Stripe from \"stripe\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Transaction from \"@/models/Transaction\";\r\nimport User from \"@/models/Users\";\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\r\n  apiVersion: \"2025-11-17.clover\",\r\n});\r\n\r\nconst MINUTES_PACKAGES = {\r\n  \"20\": { minutes: 20, price: 499 },\r\n  \"40\": { minutes: 40, price: 999 },\r\n  \"60\": { minutes: 60, price: 1499 },\r\n};\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { paymentIntentId, userId } = await req.json();\r\n\r\n    if (!paymentIntentId || !userId) {\r\n      return NextResponse.json(\r\n        { error: \"Missing required fields\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Get the payment intent to retrieve minutes and amount info\r\n    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\r\n\r\n    console.log(\"Retrieved PaymentIntent:\", {\r\n      id: paymentIntent.id,\r\n      status: paymentIntent.status,\r\n      payment_method: paymentIntent.payment_method,\r\n      customer: paymentIntent.customer,\r\n      amount: paymentIntent.amount,\r\n      metadata: paymentIntent.metadata,\r\n    });\r\n\r\n    if (paymentIntent.status !== \"succeeded\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment not completed\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const minutesStr = paymentIntent.metadata?.minutes;\r\n    const type = paymentIntent.metadata?.type;\r\n    const amount = paymentIntent.amount;\r\n    const customerId = paymentIntent.customer as string;\r\n\r\n    if (type !== \"minutes\" || !minutesStr || !amount) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid payment intent for minutes purchase\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // If we have a customer ID from the PaymentIntent, ensure it's saved to the user\r\n    if (customerId) {\r\n      const user = await User.findById(userId);\r\n      if (user && !user.stripeCustomerId) {\r\n        user.stripeCustomerId = customerId;\r\n        await user.save();\r\n      }\r\n    }\r\n\r\n    const minutesPackage = MINUTES_PACKAGES[minutesStr as keyof typeof MINUTES_PACKAGES];\r\n    if (!minutesPackage) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid minutes package\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Create transaction record\r\n    const transaction = await Transaction.create({\r\n      userId,\r\n      plan: `${minutesPackage.minutes} Minutes`,\r\n      amount,\r\n      currency: \"usd\",\r\n      stripePaymentIntentId: paymentIntent.id,\r\n      status: \"completed\",\r\n    });\r\n\r\n    if (paymentIntent.status === \"succeeded\") {\r\n      // Get the charge details\r\n      const charges = await stripe.charges.list({\r\n        payment_intent: paymentIntent.id,\r\n        limit: 1,\r\n      });\r\n\r\n      console.log(\"Charges retrieved:\", {\r\n        count: charges.data.length,\r\n        paymentIntentId: paymentIntent.id,\r\n      });\r\n\r\n      if (charges.data.length > 0) {\r\n        const charge = charges.data[0];\r\n\r\n        // Update transaction with charge details\r\n        transaction.stripeChargeId = charge.id;\r\n        if (charge.payment_method_details?.card) {\r\n          transaction.cardLast4 = charge.payment_method_details.card.last4 || undefined;\r\n          transaction.cardBrand = charge.payment_method_details.card.brand || undefined;\r\n        }\r\n        await transaction.save();\r\n\r\n        // IMPORTANT: Ensure the payment method is saved for future use\r\n        if (charge.payment_method && customerId) {\r\n          try {\r\n            console.log(\"Processing payment method for charge:\", charge.id);\r\n            console.log(\"Payment method ID from charge:\", charge.payment_method);\r\n            console.log(\"Customer ID:\", customerId);\r\n\r\n            // Retrieve the payment method to check its status\r\n            const paymentMethod = await stripe.paymentMethods.retrieve(charge.payment_method as string);\r\n            console.log(\"Retrieved payment method:\", {\r\n              id: paymentMethod.id,\r\n              customer: paymentMethod.customer,\r\n              type: paymentMethod.type,\r\n              created: paymentMethod.created,\r\n            });\r\n\r\n            // Attach payment method to customer if not already attached\r\n            if (!paymentMethod.customer) {\r\n              console.log(\"Attaching unattached payment method to customer:\", customerId);\r\n              await stripe.paymentMethods.attach(charge.payment_method as string, {\r\n                customer: customerId,\r\n              });\r\n              console.log(\"Payment method attached successfully\");\r\n            } else if (paymentMethod.customer !== customerId) {\r\n              console.log(\"Payment method attached to different customer, reattaching to:\", customerId);\r\n              await stripe.paymentMethods.attach(charge.payment_method as string, {\r\n                customer: customerId,\r\n              });\r\n              console.log(\"Payment method reattached successfully\");\r\n            } else {\r\n              console.log(\"Payment method already attached to correct customer:\", customerId);\r\n            }\r\n          } catch (pmError) {\r\n            console.error(\"Error handling payment method:\", pmError);\r\n          }\r\n        } else {\r\n          console.log(\"No payment method found in charge or no customerId\");\r\n          console.log(\"Charge details:\", {\r\n            id: charge.id,\r\n            payment_method: charge.payment_method,\r\n            customer: customerId,\r\n          });\r\n        }\r\n\r\n        // Add minutes to user's total_time\r\n        console.log(\"About to update user with ID:\", userId);\r\n        const user = await User.findById(userId);\r\n        if (user) {\r\n          console.log(\"User found:\", user);\r\n          const currentMinutes = user.total_time || 0;\r\n          user.total_time = currentMinutes + minutesPackage.minutes;\r\n          user.subscription_date = new Date();\r\n          user.subscription_amount = minutesPackage.price / 100; // Convert cents to dollars\r\n          // Set default renewal setting if not already set\r\n          if (user.renew === undefined) {\r\n            user.renew = true;\r\n          }\r\n          user.markModified('subscription_date');\r\n          user.markModified('subscription_amount');\r\n          user.markModified('renew');\r\n          await user.save();\r\n          console.log(\"User updated:\", user);\r\n        } else {\r\n          return NextResponse.json(\r\n            { error: \"User not found\" },\r\n            { status: 404 }\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      paymentIntentId: paymentIntent.id,\r\n      status: paymentIntent.status,\r\n      transactionId: transaction._id,\r\n      minutesAdded: minutesPackage.minutes,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Minutes purchase processing error:\", error);\r\n\r\n    // Handle specific Stripe errors\r\n    if (error.type === \"StripeCardError\") {\r\n      return NextResponse.json(\r\n        { error: error.message || \"Your card was declined. Please try a different payment method.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeRateLimitError\") {\r\n      return NextResponse.json(\r\n        { error: \"Too many requests. Please try again in a moment.\" },\r\n        { status: 429 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeInvalidRequestError\") {\r\n      return NextResponse.json(\r\n        { error: \"Invalid payment information. Please check your details and try again.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAPIError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service temporarily unavailable. Please try again later.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeConnectionError\") {\r\n      return NextResponse.json(\r\n        { error: \"Network error. Please check your connection and try again.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAuthenticationError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service configuration error. Please contact support.\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Handle database errors\r\n    if (error.name === \"ValidationError\") {\r\n      return NextResponse.json(\r\n        { error: \"Invalid data provided. Please check your information.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.name === \"MongoNetworkError\" || error.name === \"MongoTimeoutError\") {\r\n      return NextResponse.json(\r\n        { error: \"Database temporarily unavailable. Please try again.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { error: \"Minutes purchase failed. Please try again or contact support if the issue persists.\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\packages\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":11,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport MinutePackage from \"@/models/MinutePackage\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    await connectToDatabase();\r\n    // Only fetch active packages\r\n    const packages = await MinutePackage.find({ isActive: true }).sort({ price: 1 });\r\n    return NextResponse.json(packages);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to fetch packages\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\payments\\checkout\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PLAN_PRICES' is assigned a value but never used.","line":12,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6048,6051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6048,6051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport Stripe from \"stripe\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Transaction from \"@/models/Transaction\";\r\nimport User from \"@/models/Users\";\r\nimport Subscription from \"@/models/Subscription\";\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\r\n  apiVersion: \"2025-11-17.clover\",\r\n});\r\n\r\nconst PLAN_PRICES = {\r\n  basic: 999, // $9.99\r\n  premium: 1999, // $19.99\r\n  professional: 2999, // $29.99\r\n};\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { paymentIntentId, userId, total_time } = await req.json();\r\n\r\n    if (!paymentIntentId || !userId) {\r\n      return NextResponse.json(\r\n        { error: \"Missing required fields\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Get the payment intent to retrieve plan and amount info\r\n    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\r\n\r\n    if (paymentIntent.status !== \"succeeded\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment not completed\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const plan = paymentIntent.metadata?.plan;\r\n    const amount = paymentIntent.amount;\r\n    const customerId = paymentIntent.customer as string;\r\n\r\n    if (!plan || !amount) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid payment intent\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // If we have a customer ID from the PaymentIntent, ensure it's saved to the user\r\n    if (customerId) {\r\n      const user = await User.findById(userId);\r\n      if (user && !user.stripeCustomerId) {\r\n        user.stripeCustomerId = customerId;\r\n        await user.save();\r\n      }\r\n    }\r\n\r\n    // Create transaction record\r\n    const transaction = await Transaction.create({\r\n      userId,\r\n      plan,\r\n      amount,\r\n      currency: \"usd\",\r\n      stripePaymentIntentId: paymentIntent.id,\r\n      status: \"completed\",\r\n    });\r\n\r\n    const user = await User.findById(userId);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { error: \"User not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    let minutesToAdd = 0;\r\n    if (total_time) {\r\n      minutesToAdd = parseInt(total_time);\r\n    } else if (plan) {\r\n      // If no total_time provided but plan exists, fetch plan minutes\r\n      // We need to import Plan model first\r\n      const Plan = (await import(\"@/models/Plan\")).default;\r\n      const planDoc = await Plan.findOne({ name: plan });\r\n      if (planDoc) {\r\n        minutesToAdd = planDoc.minutes || 0;\r\n      }\r\n    }\r\n\r\n    user.total_time = (user.total_time || 0) + minutesToAdd;\r\n    await user.save();\r\n\r\n    if (paymentIntent.status === \"succeeded\") {\r\n      // Get the charge details\r\n      const charges = await stripe.charges.list({\r\n        payment_intent: paymentIntent.id,\r\n        limit: 1,\r\n      });\r\n\r\n      if (charges.data.length > 0) {\r\n        const charge = charges.data[0];\r\n\r\n        // Update transaction with charge details\r\n        transaction.stripeChargeId = charge.id;\r\n        if (charge.payment_method_details?.card) {\r\n          transaction.cardLast4 = charge.payment_method_details.card.last4 || undefined;\r\n          transaction.cardBrand = charge.payment_method_details.card.brand || undefined;\r\n        }\r\n        await transaction.save();\r\n\r\n        // IMPORTANT: Ensure the payment method is saved for future use\r\n        if (charge.payment_method && customerId) {\r\n          try {\r\n            console.log(\"Processing payment method for charge:\", charge.id);\r\n            console.log(\"Payment method ID from charge:\", charge.payment_method);\r\n            console.log(\"Customer ID:\", customerId);\r\n\r\n            // Retrieve the payment method to check its status\r\n            const paymentMethod = await stripe.paymentMethods.retrieve(charge.payment_method as string);\r\n            console.log(\"Retrieved payment method:\", {\r\n              id: paymentMethod.id,\r\n              customer: paymentMethod.customer,\r\n              type: paymentMethod.type,\r\n              created: paymentMethod.created,\r\n            });\r\n\r\n            // Attach payment method to customer if not already attached\r\n            if (!paymentMethod.customer) {\r\n              console.log(\"Attaching unattached payment method to customer:\", customerId);\r\n              await stripe.paymentMethods.attach(charge.payment_method as string, {\r\n                customer: customerId,\r\n              });\r\n              console.log(\"Payment method attached successfully\");\r\n            } else if (paymentMethod.customer !== customerId) {\r\n              console.log(\"Payment method attached to different customer, reattaching to:\", customerId);\r\n              await stripe.paymentMethods.attach(charge.payment_method as string, {\r\n                customer: customerId,\r\n              });\r\n              console.log(\"Payment method reattached successfully\");\r\n            } else {\r\n              console.log(\"Payment method already attached to correct customer:\", customerId);\r\n            }\r\n          } catch (pmError) {\r\n            console.error(\"Error handling payment method:\", pmError);\r\n          }\r\n        } else {\r\n          console.log(\"No payment method found in charge or no customerId\");\r\n          console.log(\"Charge details:\", {\r\n            id: charge.id,\r\n            payment_method: charge.payment_method,\r\n            customer: customerId,\r\n          });\r\n        }\r\n\r\n        // Create or update subscription\r\n        await Subscription.findOneAndUpdate(\r\n          { userId },\r\n          {\r\n            userId,\r\n            plan,\r\n            status: \"active\",\r\n            stripeCustomerId: customerId,\r\n            stripeSubscriptionId: paymentIntent.id,\r\n          },\r\n          { upsert: true, new: true }\r\n        );\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      paymentIntentId: paymentIntent.id,\r\n      status: paymentIntent.status,\r\n      transactionId: transaction._id,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Payment processing error:\", error);\r\n\r\n    // Handle specific Stripe errors\r\n    if (error.type === \"StripeCardError\") {\r\n      return NextResponse.json(\r\n        { error: error.message || \"Your card was declined. Please try a different payment method.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeRateLimitError\") {\r\n      return NextResponse.json(\r\n        { error: \"Too many requests. Please try again in a moment.\" },\r\n        { status: 429 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeInvalidRequestError\") {\r\n      return NextResponse.json(\r\n        { error: \"Invalid payment information. Please check your details and try again.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAPIError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service temporarily unavailable. Please try again later.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeConnectionError\") {\r\n      return NextResponse.json(\r\n        { error: \"Network error. Please check your connection and try again.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAuthenticationError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service configuration error. Please contact support.\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Handle database errors\r\n    if (error.name === \"ValidationError\") {\r\n      return NextResponse.json(\r\n        { error: \"Invalid data provided. Please check your information.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.name === \"MongoNetworkError\" || error.name === \"MongoTimeoutError\") {\r\n      return NextResponse.json(\r\n        { error: \"Database temporarily unavailable. Please try again.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { error: \"Payment processing failed. Please try again or contact support if the issue persists.\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\payments\\create-payment-intent\\route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'metadata' is never reassigned. Use 'const' instead.","line":17,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":17,"endColumn":22,"fix":{"range":[512,543],"text":"const metadata: any = { userId };"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[526,529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[526,529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3910,3913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3910,3913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport Stripe from \"stripe\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport User from \"@/models/Users\";\r\nimport Plan from \"@/models/Plan\";\r\nimport MinutePackage from \"@/models/MinutePackage\";\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\r\n  apiVersion: \"2025-11-17.clover\",\r\n});\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { minutes, plan, userId } = await req.json();\r\n\r\n    let amount = 0;\r\n    let metadata: any = { userId };\r\n\r\n    await connectToDatabase();\r\n\r\n    if (minutes) {\r\n      const pkg = await MinutePackage.findOne({ minutes: parseInt(minutes), isActive: true });\r\n      if (!pkg) {\r\n        return NextResponse.json(\r\n          { error: \"Invalid minutes package selected\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      amount = pkg.price;\r\n      metadata.type = \"minutes\";\r\n      metadata.minutes = minutes.toString();\r\n    } else if (plan) {\r\n      // plan can be the plan ID or plan name, let's assume it's the plan object or ID passed from frontend\r\n      // The frontend passes the plan object, but let's check what it sends.\r\n      // Plans.tsx sends `plan` which is the whole object. But PaymentModal receives `plan` which is the object.\r\n      // PaymentModal calls this API. Let's check PaymentModal.\r\n      // Assuming PaymentModal sends `plan` as the plan ID or we need to adjust PaymentModal.\r\n      // Actually, looking at Plans.tsx, it passes `plan` object to PaymentModal.\r\n      // PaymentModal.tsx likely sends `plan.name` or `plan._id`.\r\n      // Let's assume for now we look up by ID if it's an ID, or name.\r\n      \r\n      // If plan is an object (which it shouldn't be in JSON body unless stringified), it's likely the ID or Name.\r\n      // Let's assume it's the ID for robustness, but we need to verify PaymentModal.\r\n      \r\n      // For now, let's try to find by ID first, then Name.\r\n      let planDoc = await Plan.findOne({ _id: plan, isActive: true });\r\n      if (!planDoc) {\r\n         planDoc = await Plan.findOne({ name: plan, isActive: true });\r\n      }\r\n\r\n      if (!planDoc) {\r\n        return NextResponse.json(\r\n          { error: \"Invalid plan selected\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      amount = planDoc.price;\r\n      metadata.type = \"subscription\";\r\n      metadata.plan = planDoc.name;\r\n      metadata.planId = planDoc._id.toString();\r\n    } else {\r\n      return NextResponse.json(\r\n        { error: \"Either minutes or plan must be selected\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!userId) {\r\n      return NextResponse.json(\r\n        { error: \"User ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get user and check if they already have a Stripe customer ID\r\n    const user = await User.findById(userId);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { error: \"User not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    let customerId = user.stripeCustomerId;\r\n\r\n    // Create customer if user doesn't have one\r\n    if (!customerId) {\r\n      const customer = await stripe.customers.create({\r\n        email: user.email,\r\n        name: user.name || undefined,\r\n        metadata: {\r\n          userId: user._id.toString(),\r\n        },\r\n      });\r\n\r\n      customerId = customer.id;\r\n\r\n      // Save customer ID to user\r\n      user.stripeCustomerId = customerId;\r\n      await user.save();\r\n    }\r\n    // Create PaymentIntent with customer\r\n    const paymentIntent = await stripe.paymentIntents.create({\r\n      amount,\r\n      currency: \"usd\",\r\n      customer: customerId,\r\n      setup_future_usage: \"off_session\", // This enables saving the payment method for future use\r\n      metadata: metadata,\r\n    });\r\n\r\n    return NextResponse.json({\r\n      clientSecret: paymentIntent.client_secret,\r\n      customerId: customerId,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"PaymentIntent creation error:\", error);\r\n\r\n    // Handle specific Stripe errors\r\n    if (error.type === \"StripeCardError\") {\r\n      return NextResponse.json(\r\n        { error: error.message || \"Invalid card information.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeInvalidRequestError\") {\r\n      return NextResponse.json(\r\n        { error: \"Invalid payment request. Please check your selection.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAPIError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service temporarily unavailable. Please try again later.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeConnectionError\") {\r\n      return NextResponse.json(\r\n        { error: \"Network error. Please check your connection and try again.\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAuthenticationError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service configuration error. Please contact support.\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { error: \"Failed to create payment intent. Please try again or contact support if the issue persists.\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\payments\\get-payment-methods\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2319,2322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2319,2322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport Stripe from \"stripe\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport User from \"@/models/Users\";\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\r\n  apiVersion: \"2025-11-17.clover\",\r\n});\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { userId } = await req.json();\r\n\r\n    console.log(\"get-payment-methods called with userId:\", userId);\r\n\r\n    if (!userId) {\r\n      return NextResponse.json(\r\n        { error: \"User ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    await connectToDatabase();\r\n\r\n    // Get user and check if they have a Stripe customer ID\r\n    const user = await User.findById(userId);\r\n    console.log(\"User found:\", user ? \"YES\" : \"NO\");\r\n    console.log(\"User details:\", {\r\n      _id: user?._id,\r\n      email: user?.email,\r\n      stripeCustomerId: user?.stripeCustomerId,\r\n      total_time: user?.total_time,\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { error: \"User not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (!user.stripeCustomerId) {\r\n      console.log(\"No stripeCustomerId found for user\");\r\n      return NextResponse.json({\r\n        hasCustomer: false,\r\n        paymentMethods: [],\r\n      });\r\n    }\r\n\r\n    // Fetch payment methods from Stripe\r\n    const paymentMethods = await stripe.paymentMethods.list({\r\n      customer: user.stripeCustomerId,\r\n      type: \"card\",\r\n    });\r\n\r\n    console.log(\"Stripe payment methods response:\", {\r\n      hasMore: paymentMethods.has_more,\r\n      count: paymentMethods.data.length,\r\n      methods: paymentMethods.data.map(pm => ({\r\n        id: pm.id,\r\n        type: pm.type,\r\n        card: pm.card ? {\r\n          brand: pm.card.brand,\r\n          last4: pm.card.last4,\r\n          exp_month: pm.card.exp_month,\r\n          exp_year: pm.card.exp_year,\r\n        } : null,\r\n        customer: pm.customer,\r\n      })),\r\n    });\r\n\r\n    return NextResponse.json({\r\n      hasCustomer: true,\r\n      paymentMethods: paymentMethods.data.map(pm => ({\r\n        id: pm.id,\r\n        card: {\r\n          brand: pm.card?.brand,\r\n          last4: pm.card?.last4,\r\n          exp_month: pm.card?.exp_month,\r\n          exp_year: pm.card?.exp_year,\r\n        },\r\n      })),\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching payment methods:\", error);\r\n\r\n    if (error.type === \"StripeInvalidRequestError\") {\r\n      return NextResponse.json(\r\n        { error: \"Invalid request to payment service\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (error.type === \"StripeAPIError\") {\r\n      return NextResponse.json(\r\n        { error: \"Payment service temporarily unavailable\" },\r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch payment methods\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\plans\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":11,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Plan from \"@/models/Plan\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    await connectToDatabase();\r\n    // Only fetch active plans\r\n    const plans = await Plan.find({ isActive: true }).sort({ price: 1 });\r\n    return NextResponse.json(plans);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to fetch plans\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\profile\\update\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[940,943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[940,943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport User from \"@/models/Users\";\r\nimport { z } from \"zod\";\r\n\r\nconst updateProfileSchema = z.object({\r\n  name: z.string().min(1, \"Name is required\").max(50, \"Name must be less than 50 characters\").optional(),\r\n  profileImage: z.string().url(\"Must be a valid URL\").optional(),\r\n  total_time: z.number().min(0, \"Total time must be non-negative\").optional(),\r\n  id: z.string().optional(),\r\n});\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const parsed = updateProfileSchema.safeParse(body);\r\n\r\n    if (!parsed.success) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid input\", details: parsed.error.flatten() },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const { name, profileImage , id, total_time } = parsed.data;\r\n\r\n    await connectToDatabase();\r\n\r\n    const updateData: any = {};\r\n    if (name !== undefined) updateData.name = name;\r\n    if (profileImage !== undefined) updateData.profileImage = profileImage;\r\n    if (total_time !== undefined) updateData.total_time = total_time;\r\n\r\n    const user = await User.findByIdAndUpdate(\r\n      id,\r\n      updateData,\r\n      { new: true, runValidators: true }\r\n    ).select(\"email name total_time profileImage createdAt\");\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      message: \"Profile updated successfully\",\r\n      user: {\r\n        id: user._id.toString(),\r\n        email: user.email,\r\n        name: user.name,\r\n        profileImage: user.profileImage,\r\n        total_time: user.total_time,\r\n        createdAt: user.createdAt,\r\n      },\r\n    });\r\n  } catch (err) {\r\n    console.error(\"/api/profile/update error\", err);\r\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\profile\\upload-image\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1527,1530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1527,1530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport User from \"@/models/Users\";\r\nimport cloudinary from \"cloudinary\";\r\n\r\n// Configure Cloudinary\r\ncloudinary.v2.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    \r\n\r\n    const formData = await req.formData();\r\n    const file = formData.get(\"image\") as File;\r\n    const userId = formData.get(\"userId\") as string;\r\n\r\n    if (!file || !userId) {\r\n      return NextResponse.json(\r\n        { error: \"File and userId are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate file type\r\n    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      return NextResponse.json(\r\n        { error: \"Only JPEG, PNG, GIF, and WebP images are allowed\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate file size (5MB limit)\r\n    const maxSize = 5 * 1024 * 1024; // 5MB in bytes\r\n    if (file.size > maxSize) {\r\n      return NextResponse.json(\r\n        { error: \"File size must be less than 5MB\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Convert file to buffer\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Upload to Cloudinary\r\n    const uploadResult = await new Promise<any>((resolve, reject) => {\r\n      cloudinary.v2.uploader.upload_stream(\r\n        {\r\n          folder: \"petcare-profiles\",\r\n          transformation: [\r\n            { width: 400, height: 400, crop: \"fill\" },\r\n            { quality: \"auto\" },\r\n          ],\r\n        },\r\n        (error, result) => {\r\n          if (error) reject(error);\r\n          else resolve(result);\r\n        }\r\n      ).end(buffer);\r\n    });\r\n\r\n    if (!uploadResult || !uploadResult.secure_url) {\r\n      return NextResponse.json(\r\n        { error: \"Failed to upload image to Cloudinary\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Update user profile with image URL\r\n    const user = await User.findByIdAndUpdate(\r\n      userId,\r\n      { profileImage: uploadResult.secure_url },\r\n      { new: true, runValidators: true }\r\n    ).select(\"email name profileImage createdAt\");\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      message: \"Image uploaded successfully\",\r\n      imageUrl: uploadResult.secure_url,\r\n      user: {\r\n        id: user._id.toString(),\r\n        email: user.email,\r\n        name: user.name,\r\n        profileImage: user.profileImage,\r\n        createdAt: user.createdAt,\r\n      },\r\n    });\r\n  } catch (err) {\r\n    console.error(\"/api/profile/upload-image error\", err);\r\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\subscriptions\\check\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[737,740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[737,740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Transaction from \"@/models/Transaction\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const userId = searchParams.get('userId');\r\n\r\n    if (!userId) {\r\n      return NextResponse.json(\r\n        { error: \"Missing userId parameter\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Check if user has ANY transaction\r\n    const transaction = await Transaction.findOne({ userId: userId });\r\n    const hasTransaction = !!transaction;\r\n\r\n    return NextResponse.json({\r\n      hasTransaction\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Check subscription error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to check subscription status\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\subscriptions\\latest\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1470,1473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1470,1473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Transaction, { ITransaction } from \"@/models/Transaction\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const userId = searchParams.get('userId');\r\n\r\n    if (!userId) {\r\n      return NextResponse.json(\r\n        { error: \"Missing userId parameter\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Find the latest transaction with plan = \"basic\" or \"premium\"\r\n    const latestSubscription = await Transaction.findOne({\r\n      userId: userId,\r\n      plan: { $in: [\"basic\", \"premium\"] },\r\n      status: \"completed\"\r\n    }).sort({ createdAt: -1 }) as ITransaction | null; // Sort by createdAt descending to get the latest\r\n\r\n    if (!latestSubscription) {\r\n      return NextResponse.json({\r\n        subscription: null,\r\n        message: \"No subscription found\"\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      subscription: {\r\n        id: (latestSubscription as any)._id.toString(),\r\n        userId: latestSubscription.userId,\r\n        plan: latestSubscription.plan,\r\n        amount: latestSubscription.amount,\r\n        currency: latestSubscription.currency,\r\n        status: latestSubscription.status,\r\n        createdAt: latestSubscription.createdAt,\r\n        updatedAt: latestSubscription.updatedAt\r\n      }\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Get latest subscription error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch latest subscription\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\subscriptions\\remaining\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1470,1473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1470,1473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Transaction, { ITransaction } from \"@/models/Transaction\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const userId = searchParams.get('userId');\r\n\r\n    if (!userId) {\r\n      return NextResponse.json(\r\n        { error: \"Missing userId parameter\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    // Find the latest transaction with plan = \"basic\" or \"premium\"\r\n    const latestSubscription = await Transaction.findOne({\r\n      userId: userId,\r\n      plan: { $in: [\"basic\", \"premium\"] },\r\n      status: \"completed\"\r\n    }).sort({ createdAt: -1 }) as ITransaction | null; // Sort by createdAt descending to get the latest\r\n\r\n    if (!latestSubscription) {\r\n      return NextResponse.json({\r\n        subscription: null,\r\n        message: \"No subscription found\"\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      subscription: {\r\n        id: (latestSubscription as any)._id.toString(),\r\n        userId: latestSubscription.userId,\r\n        plan: latestSubscription.plan,\r\n        amount: latestSubscription.amount,\r\n        currency: latestSubscription.currency,\r\n        status: latestSubscription.status,\r\n        createdAt: latestSubscription.createdAt,\r\n        updatedAt: latestSubscription.updatedAt\r\n      }\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Get latest subscription error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch latest subscription\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\transactions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[680,683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[680,683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1095,1098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1095,1098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"@/lib/mongoose\";\r\nimport Transaction from \"@/models/Transaction\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { userId } = await req.json();\r\n\r\n    if (!userId) {\r\n      return NextResponse.json(\r\n        { error: \"User ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await connectToDatabase();\r\n\r\n    const transactions = await Transaction.find({ userId })\r\n      .sort({ createdAt: -1 })\r\n      .select(\"plan amount currency status cardLast4 cardBrand createdAt stripePaymentIntentId\");\r\n\r\n    const transactionData = transactions.map((t: any) => ({\r\n      _id: t._id.toString(),\r\n      plan: t.plan,\r\n      amount: t.amount,\r\n      currency: t.currency,\r\n      status: t.status,\r\n      cardLast4: t.cardLast4,\r\n      cardBrand: t.cardBrand,\r\n      createdAt: t.createdAt.toISOString(),\r\n      stripePaymentIntentId: t.stripePaymentIntentId,\r\n    }));\r\n\r\n    return NextResponse.json({\r\n      transactions: transactionData,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching transactions:\", error);\r\n\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch transactions\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\api\\users\\[userId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\chat\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'userId'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [chatId, userId]","fix":{"range":[1132,1140],"text":"[chatId, userId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":97,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport ChatLayout from \"@/app/components/chat/Layout\";\r\nimport ChatMenu from \"@/app/components/chat/ChatMenu\";\r\n\r\ninterface Message {\r\n  _id: string;\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n  timestamp: string;\r\n}\r\n\r\nimport { useSession } from \"next-auth/react\";\r\n\r\nexport default function ChatPage() {\r\n  const params = useParams();\r\n  const chatId = params?.id as string;\r\n  const { data: session } = useSession();\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const userId = session?.user?.id;\r\n\r\n  // Fetch messages from API\r\n  useEffect(() => {\r\n    if (!chatId) return;\r\n    const fetchChat = async () => {\r\n      try {\r\n        const res = await fetch(`/api/chat/${chatId}?userId=${userId}`);\r\n        const data = await res.json();\r\n        setMessages(data.messages || []);\r\n      } catch (err) {\r\n        console.error(\"Error fetching chat:\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchChat();\r\n  }, [chatId]);\r\n\r\n  return (\r\n    <ChatLayout userId={userId || undefined}>\r\n      <div className=\"flex flex-col h-full bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100\">\r\n        {/* Header */}\r\n        <header className=\"p-6 bg-white/80 backdrop-blur-lg border-b border-white/20 shadow-sm\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            <h1 className=\"text-2xl font-bold bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] bg-clip-text text-transparent\">\r\n              Chat with AI\r\n            </h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Conversation history</p>\r\n          </div>\r\n          <ChatMenu />\r\n        </header>\r\n\r\n        {/* Messages Area */}\r\n        <main className=\"flex-1 overflow-y-auto p-6\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            {loading ? (\r\n              <div className=\"flex items-center justify-center h-64\">\r\n                <div className=\"flex space-x-2\">\r\n                  <div className=\"w-3 h-3 bg-purple-400 rounded-full animate-bounce\"></div>\r\n                  <div\r\n                    className=\"w-3 h-3 bg-purple-400 rounded-full animate-bounce\"\r\n                    style={{ animationDelay: \"0.1s\" }}\r\n                  ></div>\r\n                  <div\r\n                    className=\"w-3 h-3 bg-purple-400 rounded-full animate-bounce\"\r\n                    style={{ animationDelay: \"0.2s\" }}\r\n                  ></div>\r\n                </div>\r\n                <p className=\"ml-4 text-gray-600\">Loading messages...</p>\r\n              </div>\r\n            ) : messages.length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center h-64 text-gray-500\">\r\n                <div className=\"w-16 h-16 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full flex items-center justify-center mb-4\">\r\n                  <svg\r\n                    className=\"w-8 h-8 text-gray-400\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <p className=\"text-lg font-medium\">No messages yet</p>\r\n                <p className=\"text-sm\">\r\n                  Start a conversation to see your chat history here\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-6\">\r\n                {messages.map((msg, index) => (\r\n                  <div\r\n                    key={msg._id}\r\n                    className={`flex ${\r\n                      msg.role === \"user\" ? \"justify-end\" : \"justify-start\"\r\n                    }`}\r\n                  >\r\n                    <div\r\n                      className={`group max-w-2xl ${\r\n                        msg.role === \"user\" ? \"ml-auto\" : \"mr-auto\"\r\n                      }`}\r\n                    >\r\n                      {/* Message bubble */}\r\n                      <div\r\n                        className={`relative px-6 py-4 rounded-2xl shadow-sm transition-all duration-200 hover:shadow-md ${\r\n                          msg.role === \"user\"\r\n                            ? \"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-br-md\"\r\n                            : \"bg-white/80 backdrop-blur-sm text-gray-800 border border-white/50 rounded-bl-md\"\r\n                        }`}\r\n                      >\r\n                        <div className=\"prose prose-sm max-w-none\">\r\n                          <p className=\"text-sm leading-relaxed whitespace-pre-wrap mb-0\">\r\n                            {msg.content}\r\n                          </p>\r\n                        </div>\r\n\r\n                        {/* Timestamp */}\r\n                        <div\r\n                          className={`flex items-center justify-between mt-3 text-xs ${\r\n                            msg.role === \"user\"\r\n                              ? \"text-blue-100\"\r\n                              : \"text-gray-500\"\r\n                          }`}\r\n                        >\r\n                          <span className=\"opacity-75\">\r\n                            {new Date(msg.timestamp).toLocaleTimeString([], {\r\n                              hour: \"2-digit\",\r\n                              minute: \"2-digit\",\r\n                            })}\r\n                          </span>\r\n                          {msg.role === \"user\" && (\r\n                            <span className=\"opacity-50\">You</span>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Message tail */}\r\n                        <div\r\n                          className={`absolute top-4 w-3 h-3 ${\r\n                            msg.role === \"user\"\r\n                              ? \"right-0 bg-gradient-to-br from-blue-500 to-blue-600 transform rotate-45 -mr-1\"\r\n                              : \"left-0 bg-white transform rotate-45 -ml-1 border-l border-t border-white/50\"\r\n                          }`}\r\n                        ></div>\r\n                      </div>\r\n\r\n                      {/* Avatar placeholder */}\r\n                      {/* <div className={`w-8 h-8 rounded-full flex items-center justify-center mt-2 ${\r\n                        msg.role === \"user\"\r\n                          ? \"ml-auto mr-2 bg-gradient-to-br from-blue-400 to-blue-500\"\r\n                          : \"mr-auto ml-2 bg-gradient-to-br from-gray-300 to-gray-400\"\r\n                      }`}>\r\n                        <span className=\"text-xs font-semibold text-white\">\r\n                          {msg.role === \"user\" ? \"U\" : \"AI\"}\r\n                        </span>\r\n                      </div> */}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </ChatLayout>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\chat\\page.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useRouter\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":17,"column":18,"nodeType":"Identifier","endLine":17,"endColumn":27},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useSession\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":18,"column":37,"nodeType":"Identifier","endLine":18,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":19,"column":37,"nodeType":"Identifier","endLine":19,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chatHistory' is assigned a value but never used.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":21},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":20,"column":41,"nodeType":"Identifier","endLine":20,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":15},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":21,"column":29,"nodeType":"Identifier","endLine":21,"endColumn":37},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":23,"column":3,"nodeType":"Identifier","endLine":23,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initializeChatSession'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [status, router, initializeChatSession]","fix":{"range":[888,904],"text":"[status, router, initializeChatSession]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":78,"column":40,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2761,2881],"text":"\r\n                  Speak naturally and I&apos;ll help you with your pet care\r\n                  questions.\r\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2761,2881],"text":"\r\n                  Speak naturally and I&lsquo;ll help you with your pet care\r\n                  questions.\r\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2761,2881],"text":"\r\n                  Speak naturally and I&#39;ll help you with your pet care\r\n                  questions.\r\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2761,2881],"text":"\r\n                  Speak naturally and I&rsquo;ll help you with your pet care\r\n                  questions.\r\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport ChatLayout from \"@/app/components/chat/Layout\";\r\nimport VoiceChat from \"@/app/components/chat/VoiceChat\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport ChatMenu from \"@/app/components/chat/ChatMenu\";\r\nimport { useSession } from \"next-auth/react\";\r\n\r\ninterface Message {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n  timestamp: Date;\r\n}\r\n\r\nconst page = () => {\r\n  const router = useRouter();\r\n  const { data: session, status } = useSession();\r\n  const [sessionId, setSessionId] = useState<string>(\"\");\r\n  const [chatHistory, setChatHistory] = useState<Message[]>([]);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (status === \"unauthenticated\") {\r\n      router.push(\"/login\");\r\n    } else if (status === \"authenticated\") {\r\n      initializeChatSession();\r\n    }\r\n  }, [status, router]);\r\n\r\n  const generateNewSessionId = () => {\r\n    return (\r\n      \"session_\" + Date.now() + \"_\" + Math.random().toString(36).substr(2, 9)\r\n    );\r\n  };\r\n\r\n  const initializeChatSession = async () => {\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    try {\r\n      // Always generate a new unique session ID for each chat session\r\n      const currentSessionId = generateNewSessionId();\r\n      setSessionId(currentSessionId);\r\n    } catch (err) {\r\n      console.error(\"Failed to initialize chat session:\", err);\r\n      setError(err instanceof Error ? err.message : String(err));\r\n    }\r\n  };\r\n\r\n  const handleNewChatSession = () => {\r\n    // Generate a new session ID when user wants to start a fresh chat\r\n    const newSessionId = generateNewSessionId();\r\n    setSessionId(newSessionId);\r\n    setChatHistory([]); // Clear chat history for new session\r\n  };\r\n\r\n  if (status === \"loading\") {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#B57DFF]\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (status === \"unauthenticated\") return null;\r\n\r\n  return (\r\n    <ChatLayout onNewChat={handleNewChatSession} userId={session?.user?.id}>\r\n      <div className=\"flex-1 flex flex-col items-center justify-center p-4 md:p-8\">\r\n        <div className=\"text-center mb-8 max-w-2xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div>\r\n                <h1 className=\"text-4xl md:text-5xl font-bold bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] bg-clip-text text-transparent mb-4\">\r\n                  Voice Chat Assistant\r\n                </h1>\r\n                <p className=\"text-gray-600 text-lg mb-8 max-w-md mx-auto\">\r\n                  Speak naturally and I'll help you with your pet care\r\n                  questions.\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <ChatMenu />\r\n          </div>\r\n\r\n          <div className=\"mb-8 max-w-md mx-auto\">\r\n            <VoiceChat\r\n              sessionId={sessionId}\r\n              userId={session?.user?.id}\r\n              onMessage={(message) => {\r\n                setChatHistory((prev) => [...prev, message]);\r\n              }}\r\n              onError={(error) => {\r\n                setError(error);\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ChatLayout>\r\n  );\r\n};\r\n\r\nexport default page;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\auth\\AuthForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1864,1867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1864,1867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useRouter } from \"next/navigation\";\r\nimport React, { useState } from \"react\";\r\nimport { BsEye, BsEyeSlash } from \"react-icons/bs\";\r\nimport { signIn } from \"next-auth/react\";\r\n\r\ntype Mode = \"login\" | \"signup\";\r\n\r\nexport default function AuthForm({ mode = \"login\" }: { mode?: Mode }) {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [name, setName] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const router = useRouter();\r\n\r\n  async function onSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      if (mode === \"signup\") {\r\n        // Register new user\r\n        const res = await fetch(\"/api/auth/register\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ email, password, name }),\r\n        });\r\n\r\n        const data = await res.json();\r\n        if (!res.ok) throw new Error(data?.error || \"Registration failed\");\r\n\r\n        // Auto-login after successful registration\r\n        const result = await signIn(\"credentials\", {\r\n          email,\r\n          password,\r\n          redirect: false,\r\n        });\r\n\r\n        if (result?.error) {\r\n          throw new Error(result.error);\r\n        }\r\n\r\n        router.push(\"/chat\");\r\n        router.refresh();\r\n      } else {\r\n        // Login existing user\r\n        const result = await signIn(\"credentials\", {\r\n          email,\r\n          password,\r\n          redirect: false,\r\n        });\r\n\r\n        if (result?.error) {\r\n          throw new Error(result.error);\r\n        }\r\n\r\n        router.push(\"/chat\");\r\n        router.refresh();\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || \"Something went wrong\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form\r\n      onSubmit={onSubmit}\r\n      className=\"max-w-md mx-auto bg-white shadow rounded-lg p-6 space-y-4 border border-gray-100\"\r\n    >\r\n      <h1 className=\"text-2xl font-bold text-slate-900\">\r\n        {mode === \"signup\" ? \"Create account\" : \"Welcome back\"}\r\n      </h1>\r\n      <p className=\"text-sm text-slate-600\">\r\n        {mode === \"signup\"\r\n          ? \"Sign up with your email and a password.\"\r\n          : \"Log in to your account.\"}\r\n      </p>\r\n      {mode === \"signup\" && (\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-slate-700\">\r\n            Name\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            placeholder=\"Your name\"\r\n          />\r\n        </div>\r\n      )}\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-slate-700\">\r\n          Email\r\n        </label>\r\n        <input\r\n          type=\"email\"\r\n          className=\"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\"\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n          placeholder=\"you@example.com\"\r\n          required\r\n        />\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-slate-700\">\r\n          Password\r\n        </label>\r\n        <div className=\"relative\">\r\n          <input\r\n            type={showPassword ? \"text\" : \"password\"}\r\n            className=\"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-orange-400\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            placeholder=\"\"\r\n            required\r\n          />\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setShowPassword(!showPassword)}\r\n            className=\"absolute inset-y-0 right-0 pr-3 flex items-center\"\r\n          >\r\n            {showPassword ? (\r\n              <BsEyeSlash className=\"h-4 w-4 text-gray-400 hover:text-gray-600\" />\r\n            ) : (\r\n              <BsEye className=\"h-4 w-4 text-gray-400 hover:text-gray-600\" />\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n      {error && <div className=\"text-sm text-red-600\">{error}</div>}\r\n      <button\r\n        type=\"submit\"\r\n        disabled={loading}\r\n        className=\"w-full rounded-md bg-gradient-to-r from-[#B57DFF] to-[#ff8a1e] text-white py-2.5 font-medium shadow hover:opacity-95 disabled:opacity-60\"\r\n      >\r\n        {loading\r\n          ? mode === \"signup\"\r\n            ? \"Creating...\"\r\n            : \"Logging in...\"\r\n          : mode === \"signup\"\r\n          ? \"Sign up\"\r\n          : \"Log in\"}\r\n      </button>\r\n    </form>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\auth\\AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\chat\\ChatMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":8,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\";\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { signOut } from \"next-auth/react\";\r\nimport { BsCreditCard } from \"react-icons/bs\";\r\n\r\nconst ChatMenu = () => {\r\n  const router = useRouter();\r\n  const [isMenuOpen, setIsMenuOpen] = useState<boolean>(false);\r\n\r\n  const logout = async () => {\r\n    await signOut({ callbackUrl: \"/\" });\r\n  };\r\n  return (\r\n    <div className=\"absolute top-0 right-0 lg:top-6 lg:right-6 z-50\">\r\n      <div className=\"relative\">\r\n        <button\r\n          onClick={() => setIsMenuOpen(!isMenuOpen)}\r\n          className=\"group flex items-center space-x-3 bg-gradient-to-br from-[#B57DFF] to-[#B57DFF] backdrop-blur-md border border-white/20 rounded-xl px-2 py-2 md:px-4 md:py-3 text-white hover:bg-white/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl\"\r\n        >\r\n          <div className=\"p-2 m-0 lg:mr-2 rounded-lg bg-white/20 group-hover:bg-white/30 transition-all duration-300\">\r\n            <svg\r\n              className=\"w-5 h-5\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M4 6h16M4 12h16M4 18h16\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <span className=\"text-sm hidden lg:block font-semibold tracking-wide\">\r\n            Menu\r\n          </span>\r\n        </button>\r\n\r\n        {isMenuOpen && (\r\n          <div className=\"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-60\">\r\n            {/* <Link\r\n            href=\"/\"\r\n            className=\"flex items-center px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors duration-200\"\r\n            onClick={() => setIsMenuOpen(false)}\r\n          >\r\n            <svg\r\n              className=\"w-4 h-4 mr-3\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"\r\n              />\r\n            </svg>\r\n            Home\r\n          </Link> */}\r\n            <Link\r\n              href=\"/profile\"\r\n              className=\"flex items-center px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors duration-200\"\r\n              onClick={() => setIsMenuOpen(false)}\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4 mr-3\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"\r\n                />\r\n              </svg>\r\n              Profile\r\n            </Link>\r\n            <Link\r\n              href=\"/transactions\"\r\n              className=\"flex items-center px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors duration-200\"\r\n              onClick={() => setIsMenuOpen(false)}\r\n            >\r\n              <BsCreditCard className=\"w-4 h-4 mr-3\" />\r\n              Transactions\r\n            </Link>\r\n            <Link\r\n              href=\"/chat\"\r\n              className=\"flex items-center px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors duration-200\"\r\n              onClick={() => setIsMenuOpen(false)}\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4 mr-3\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\r\n                />\r\n              </svg>\r\n              Chat\r\n            </Link>\r\n            <button\r\n              onClick={() => {\r\n                // Handle logout logic here\r\n                logout();\r\n              }}\r\n              className=\"flex items-center w-full px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors duration-200\"\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4 mr-3\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                />\r\n              </svg>\r\n              Logout\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatMenu;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\chat\\Layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isChatPage' is assigned a value but never used.","line":54,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isIndividualChatPage' is assigned a value but never used.","line":55,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useRouter, usePathname } from \"next/navigation\";\r\nimport { useSession } from \"next-auth/react\";\r\n// import Header from './Header'\r\n\r\ninterface ChatSession {\r\n  id: string;\r\n  title?: string;\r\n  createdAt: string;\r\n  lastMessage?: string;\r\n  messageCount?: number;\r\n}\r\n\r\ninterface ChatLayoutProps {\r\n  children: React.ReactNode;\r\n  onNewChat?: () => void;\r\n  userId?: string; // Kept for backward compatibility but optional\r\n}\r\n\r\nconst ChatLayout: React.FC<ChatLayoutProps> = ({ children, onNewChat }) => {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const { data: session } = useSession();\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [chatSessions, setChatSessions] = useState<ChatSession[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (session?.user?.id) {\r\n      loadChatSessions(session.user.id);\r\n    }\r\n  }, [session?.user?.id]);\r\n\r\n  const loadChatSessions = async (currentUserId: string) => {\r\n    if (typeof window === \"undefined\" || !currentUserId) return;\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `/api/chat/all_sessions?userId=${currentUserId}`\r\n      );\r\n      if (response.ok) {\r\n        const sessions = await response.json();\r\n        setChatSessions(sessions);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to load chat sessions:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const isChatPage = pathname === \"/chat\";\r\n  const isIndividualChatPage =\r\n    pathname.startsWith(\"/chat/\") && pathname !== \"/chat\";\r\n\r\n  return (\r\n    <>\r\n      {/* <Header /> */}\r\n      <div className=\"font-sans text-gray-800 min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\">\r\n        <div className=\"flex h-screen\">\r\n          {/* Sidebar */}\r\n          <div\r\n            className={`\r\n          ${sidebarOpen ? \"w-80\" : \"w-0 md:w-80\"}\r\n          bg-white shadow-xl transition-all duration-300 ease-in-out overflow-hidden\r\n          border-r border-gray-200 flex flex-col fixed md:relative z-50 md:z-auto h-full\r\n        `}\r\n          >\r\n            {/* Sidebar Header */}\r\n            <div className=\"p-4 border-b border-gray-200 bg-gradient-to-r from-[#B57DFF] to-[#B57DFF]\">\r\n              <div className=\"flex items-center justify-between text-white\">\r\n                <h2 className=\"text-lg font-semibold\">Chat History</h2>\r\n                <button\r\n                  onClick={() => setSidebarOpen(false)}\r\n                  className=\"md:hidden p-1 hover:bg-white/20 rounded transition-colors\"\r\n                >\r\n                  <svg\r\n                    className=\"w-5 h-5\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M6 18L18 6M6 6l12 12\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Chat Sessions List */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n              {loading ? (\r\n                <div className=\"flex items-center justify-center py-8\">\r\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                </div>\r\n              ) : chatSessions.length === 0 ? (\r\n                <div className=\"text-center text-gray-500 py-8\">\r\n                  <svg\r\n                    className=\"w-12 h-12 mx-auto mb-3 opacity-50\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={1.5}\r\n                      d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\r\n                    />\r\n                  </svg>\r\n                  <p className=\"text-sm\">No chat sessions yet</p>\r\n                  <p className=\"text-xs mt-1\">\r\n                    Start a conversation to see it here\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                chatSessions.map((session) => (\r\n                  <div\r\n                    key={session.id}\r\n                    className={`\r\n                    p-3 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md\r\n                    ${\r\n                      pathname === `/chat/${session.id}`\r\n                        ? \"bg-blue-50 border border-blue-200 shadow-sm\"\r\n                        : \"bg-gray-50 hover:bg-gray-100 border border-transparent\"\r\n                    }\r\n                  `}\r\n                    onClick={() => {\r\n                      if (pathname !== `/chat/${session.id}`) {\r\n                        router.push(`/chat/${session.id}`);\r\n                        setSidebarOpen(false);\r\n                      }\r\n                    }}\r\n                  >\r\n                    <div className=\"flex items-start justify-between mb-2\">\r\n                      <h3 className=\"font-medium text-gray-900 text-sm truncate flex-1\">\r\n                        {session.title || `Session ${session.id.slice(-8)}`}\r\n                      </h3>\r\n                      <span className=\"text-xs text-gray-500 ml-2 flex-shrink-0\">\r\n                        {new Date(session.createdAt).toLocaleDateString()}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-xs text-gray-600 line-clamp-2\">\r\n                      {session.lastMessage || \"No messages yet\"}\r\n                    </p>\r\n                    <div className=\"flex items-center justify-between mt-2\">\r\n                      <span className=\"text-xs text-gray-500\">\r\n                        {session.messageCount || 0} messages\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </div>\r\n\r\n            {/* Sidebar Footer */}\r\n            <div className=\"p-4 border-t border-gray-200 fixed bottom-0 w-80 space-y-2\">\r\n              {onNewChat && (\r\n                <button\r\n                  onClick={() => {\r\n                    onNewChat();\r\n                    setSidebarOpen(false);\r\n                  }}\r\n                  className=\" w-full py-2 px-4 rounded-lg font-medium transition-colors cursor-pointer bg-gradient-to-br from-[#B57DFF] to-[#B57DFF] text-white\"\r\n                >\r\n                   New Voice Chat\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Overlay for mobile */}\r\n          {sidebarOpen && (\r\n            <div\r\n              className=\"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden\"\r\n              onClick={() => setSidebarOpen(false)}\r\n            />\r\n          )}\r\n\r\n          {/* Main Content */}\r\n          <div className=\"flex-1 flex flex-col min-w-0\">\r\n            {/* Mobile Sidebar Toggle */}\r\n            {!sidebarOpen && (\r\n              <div className=\"md:hidden p-4 border-b border-gray-200 bg-white shadow-sm\">\r\n                <button\r\n                  onClick={() => setSidebarOpen(true)}\r\n                  className=\"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors\"\r\n                >\r\n                  <svg\r\n                    className=\"w-5 h-5\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M4 6h16M4 12h16M4 18h16\"\r\n                    />\r\n                  </svg>\r\n                  <span className=\"text-sm\">Chat History</span>\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {/* Page Content */}\r\n            <div className=\"flex-1 overflow-auto\">{children}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ChatLayout;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\chat\\VoiceChat.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Role' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mic' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MicOff' is defined but never used.","line":5,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isListening' is assigned a value but never used.","line":40,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1425,1428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1425,1428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSpeaking' is assigned a value but never used.","line":163,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useRef, useEffect } from \"react\";\r\nimport { Role, useConversation } from \"@elevenlabs/react\";\r\nimport { Mic, MicOff, Volume2, VolumeX } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useSession } from \"next-auth/react\";\r\nimport MinutesSection from \"@/app/components/payment/Packages\";\r\nimport Plans from \"@/app/components/home/Plans\";\r\n\r\ninterface VoiceChatProps {\r\n  sessionId: string;\r\n  userId?: string;\r\n  onMessage?: (message: {\r\n    role: \"user\" | \"assistant\";\r\n    content: string;\r\n    timestamp: Date;\r\n  }) => void;\r\n  onError?: (error: string) => void;\r\n}\r\n\r\ninterface Message {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n  timestamp: Date;\r\n}\r\n\r\nexport default function VoiceChat({\r\n  sessionId,\r\n  userId,\r\n  onMessage,\r\n  onError,\r\n}: VoiceChatProps) {\r\n  const router = useRouter();\r\n  const { data: session } = useSession();\r\n  const [hasPermission, setHasPermission] = useState(false);\r\n  const [totalTime, setTotalTime] = useState(0);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  const [errorMessage, setErrorMessage] = useState(\"\");\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [currentTranscript, setCurrentTranscript] = useState(\"\");\r\n  const callStartTimeRef = useRef<Date | null>(null);\r\n  const [agentResponse, setAgentResponse] = useState<string>(\"\");\r\n  const [xeno, setXeno] = useState<any>(false);\r\n\r\n  useEffect(() => {\r\n    const fetchUserData = async () => {\r\n      if (session?.user?.id) {\r\n        try {\r\n          //  fetch from your backend\r\n          const res = await fetch(`/api/users/${session.user.id}`);\r\n          const data = await res.json();\r\n          if (!res.ok) {\r\n            console.error(\"Failed to fetch user data:\", data);\r\n            return;\r\n          }\r\n\r\n          // Set state with fresh data\r\n          setTotalTime(data?.total_time || 0);\r\n        } catch (e) {\r\n          console.error(\"Failed to fetch user data\", e);\r\n        }\r\n      }\r\n    };\r\n\r\n    fetchUserData();\r\n  }, [xeno, session?.user?.id]);\r\n\r\n  // console.log(\"Total time:\", totalTime);\r\n  const handleCallEnd = async () => {\r\n    console.log(\"Call ended\");\r\n    console.log(callStartTimeRef.current);\r\n    let startTime = callStartTimeRef.current;\r\n    if (!startTime) {\r\n      console.log(\"Call start Time Not Found\");\r\n      startTime = new Date(Date.now() - 60000); // Set to 1 minute ago if null\r\n      callStartTimeRef.current = startTime; // Update ref for future use\r\n    }\r\n\r\n    const callEndTime = new Date();\r\n    console.log(callEndTime);\r\n    const callDurationMs = callEndTime.getTime() - startTime.getTime();\r\n    console.log(callDurationMs);\r\n    const callDurationSeconds = callDurationMs / 1000; // Round up to nearest minute\r\n    console.log(callDurationSeconds);\r\n    const minutes = Math.floor(callDurationSeconds / 60);\r\n    const remainderSeconds = callDurationSeconds % 60;\r\n\r\n    const callDurationMinutes = remainderSeconds > 30 ? minutes + 1 : minutes;\r\n    console.log(\"Call duration minutes:\", callDurationMinutes);\r\n    if (callDurationMinutes <= 0) return;\r\n\r\n    if (!session?.user?.id) return;\r\n\r\n    try {\r\n      // Update user's total_time in the database\r\n      const response = await fetch(\"/api/profile/update\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          id: session.user.id,\r\n          total_time: Math.max(0, totalTime - callDurationMinutes),\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n\r\n        setTotalTime(result.user.total_time);\r\n        router.refresh(); // Refresh session data\r\n\r\n        console.log(\r\n          `Call duration: ${callDurationMinutes} minutes. Remaining time: ${result.user.total_time} minutes.`\r\n        );\r\n      } else {\r\n        console.error(\"Failed to update user total_time\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating call duration:\", error);\r\n    }\r\n\r\n    callStartTimeRef.current = null; // Reset call start time\r\n  };\r\n\r\n  const conversation = useConversation({\r\n    onConnect: () => {\r\n      console.log(\"Connected to ElevenLabs voice agent\");\r\n      setErrorMessage(\"\");\r\n      const startTime = new Date();\r\n      console.log(\"Setting call start time to:\", startTime);\r\n      callStartTimeRef.current = startTime;\r\n    },\r\n    onDisconnect: () => {\r\n      console.log(\"Total time before disconnect:\", callStartTimeRef.current);\r\n      console.log(\"Disconnected from ElevenLabs voice agent\");\r\n      handleCallEnd(); // Calculate and update call duration\r\n    },\r\n    onMessage: (\r\n      message: string | { message: string; source: \"user\" | \"ai\" }\r\n    ) => {\r\n      console.log(\"Received message from voice agent:\", message);\r\n      const assistantMessage: Message = {\r\n        role: \"assistant\",\r\n        content: typeof message === \"string\" ? message : message.message,\r\n        timestamp: new Date(),\r\n      };\r\n      setAgentResponse(typeof message === \"string\" ? message : message.message);\r\n      onMessage?.(assistantMessage);\r\n\r\n      // Save assistant message to database\r\n      saveMessageToDB(assistantMessage);\r\n    },\r\n    onError: (error: string | Error) => {\r\n      const errorMsg = typeof error === \"string\" ? error : error.message;\r\n      setErrorMessage(errorMsg);\r\n      onError?.(errorMsg);\r\n      console.error(\"ElevenLabs error:\", error);\r\n    },\r\n  });\r\n\r\n  const { status, isSpeaking } = conversation;\r\n\r\n  // Request microphone permission on mount\r\n  useEffect(() => {\r\n    const requestMicPermission = async () => {\r\n      try {\r\n        await navigator.mediaDevices.getUserMedia({ audio: true });\r\n        setHasPermission(true);\r\n      } catch (error) {\r\n        const errorMsg = \"Microphone access denied\";\r\n        setErrorMessage(errorMsg);\r\n        onError?.(errorMsg);\r\n        console.error(\"Error accessing microphone:\", error);\r\n      }\r\n    };\r\n\r\n    requestMicPermission();\r\n  }, [onError]);\r\n\r\n  // Save message to database\r\n  const saveMessageToDB = async (message: Message) => {\r\n    try {\r\n      console.log(\r\n        \"Saving message with userId:\",\r\n        userId,\r\n        \"sessionId:\",\r\n        sessionId\r\n      ); // Debug log\r\n      const response = await fetch(\"/api/chat/save\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          sessionId,\r\n          userId,\r\n          message: message.content,\r\n          role: message.role,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to save message\");\r\n      }\r\n\r\n      const result = await response.json();\r\n      console.log(\"Save result:\", result); // Debug log\r\n    } catch (error) {\r\n      console.error(\"Error saving message to database:\", error);\r\n      onError?.(\"Failed to save message to database\");\r\n    }\r\n  };\r\n\r\n  const [showMinutesModal, setShowMinutesModal] = useState(false);\r\n  const [showPlansModal, setShowPlansModal] = useState(false);\r\n  const handleStartConversation = async () => {\r\n    try {\r\n      // Check if user has any subscription/transaction\r\n      if (session?.user?.id) {\r\n        const response = await fetch(\r\n          `/api/subscriptions/check?userId=${session.user.id}`\r\n        );\r\n        const data = await response.json();\r\n\r\n        if (!data.hasTransaction) {\r\n          // No subscription found, navigate to plans\r\n          // router.push('/#plans');\r\n          setShowPlansModal(true);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (totalTime <= 0) {\r\n        console.log(\"Total time is less than or equal to 0\");\r\n        setShowMinutesModal(true);\r\n        return;\r\n      }\r\n      // Get agent ID from environment variable\r\n      const agentId = process.env.NEXT_PUBLIC_ELEVENLABS_AGENT_ID;\r\n\r\n      if (!agentId) {\r\n        const errorMsg = \"ElevenLabs agent ID not configured\";\r\n        setErrorMessage(errorMsg);\r\n        onError?.(errorMsg);\r\n        return;\r\n      }\r\n\r\n      await conversation.startSession({\r\n        agentId: agentId,\r\n        userId: sessionId, // Use session ID as user identifier\r\n        connectionType: \"websocket\",\r\n      });\r\n\r\n      setIsListening(true);\r\n      console.log(\"Started voice conversation with agent:\", agentId);\r\n    } catch (error) {\r\n      const errorMsg = \"Failed to start voice conversation\";\r\n      setErrorMessage(errorMsg);\r\n      onError?.(errorMsg);\r\n      console.error(\"Error starting voice conversation:\", error);\r\n    }\r\n  };\r\n\r\n  const handleEndConversation = async () => {\r\n    try {\r\n      await conversation.endSession();\r\n      setIsListening(false);\r\n      setCurrentTranscript(\"\");\r\n\r\n      // If user was speaking, save their final message\r\n      if (currentTranscript.trim()) {\r\n        const userMessage: Message = {\r\n          role: \"user\",\r\n          content: currentTranscript.trim(),\r\n          timestamp: new Date(),\r\n        };\r\n        onMessage?.(userMessage);\r\n        await saveMessageToDB(userMessage);\r\n      }\r\n    } catch (error) {\r\n      const errorMsg = \"Failed to end voice conversation\";\r\n      setErrorMessage(errorMsg);\r\n      onError?.(errorMsg);\r\n      console.error(\"Error ending voice conversation:\", error);\r\n    }\r\n  };\r\n\r\n  const toggleMute = async () => {\r\n    try {\r\n      await conversation.setVolume({ volume: isMuted ? 1 : 0 });\r\n      setIsMuted(!isMuted);\r\n    } catch (error) {\r\n      const errorMsg = \"Failed to change volume\";\r\n      setErrorMessage(errorMsg);\r\n      onError?.(errorMsg);\r\n      console.error(\"Error changing volume:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full max-w-md mx-auto bg-white rounded-lg shadow-lg p-6\">\r\n      {/* {totalTime} */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold\">Voice Chat</h3>\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            onClick={toggleMute}\r\n            disabled={status !== \"connected\"}\r\n            className={`p-2 rounded-full transition-colors ${\r\n              status === \"connected\"\r\n                ? isMuted\r\n                  ? \"bg-purple-100 hover:bg-purple-200\"\r\n                  : \"bg-blue-100 hover:bg-blue-200\"\r\n                : \"bg-gray-100 cursor-not-allowed\"\r\n            }`}\r\n            title={isMuted ? \"Unmute\" : \"Mute\"}\r\n          >\r\n            {isMuted ? (\r\n              <VolumeX className=\"h-4 w-4 text-[#B57DFF]\" />\r\n            ) : (\r\n              <Volume2 className=\"h-4 w-4 text-blue-600\" />\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Display */}\r\n      <div className=\"mb-4 text-center\">\r\n        <div\r\n          className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${\r\n            status === \"connected\"\r\n              ? \"bg-green-100 text-green-800\"\r\n              : status === \"connecting\"\r\n              ? \"bg-yellow-100 text-yellow-800\"\r\n              : \"bg-gray-100 text-gray-800\"\r\n          }`}\r\n        >\r\n          <div\r\n            className={`w-2 h-2 rounded-full ${\r\n              status === \"connected\" ? \"bg-green-500\" : \"bg-gray-400\"\r\n            }`}\r\n          />\r\n          Status: {status}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Current Transcript Display */}\r\n      {currentTranscript && (\r\n        <div className=\"mb-4 p-3 bg-blue-50 rounded-lg hidden\">\r\n          <p className=\"text-sm text-blue-800\">\r\n            <span className=\"font-medium\">You said:</span> {currentTranscript}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Agent Response Display */}\r\n      {agentResponse && (\r\n        <div className=\"mb-4 p-3 bg-green-50 rounded-lg hidden\">\r\n          <p className=\"text-sm text-green-800\">\r\n            <span className=\"font-medium\">Agent:</span> {agentResponse}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Error Display */}\r\n      {errorMessage && (\r\n        <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n          <p className=\"text-sm text-red-800\">{errorMessage}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Control Buttons */}\r\n      <div className=\"flex justify-center\">\r\n        {/* {status === \"connected\" ? (\r\n          <button\r\n            onClick={handleEndConversation}\r\n            className=\"flex items-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors\"\r\n          >\r\n            <MicOff className=\"h-4 w-4\" />\r\n            End Voice Chat\r\n          </button>\r\n        ) : (\r\n          <button\r\n            onClick={handleStartConversation}\r\n            disabled={!hasPermission}\r\n            className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${\r\n              hasPermission\r\n                ? 'bg-blue-500 hover:bg-blue-600 text-white'\r\n                : 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n            }`}\r\n          >\r\n            <Mic className=\"h-4 w-4\" />\r\n            Start Voice Chat\r\n          </button>\r\n        )} */}\r\n        <button\r\n          onClick={\r\n            status === \"connected\"\r\n              ? handleEndConversation\r\n              : handleStartConversation\r\n          }\r\n          //   disabled={isProcessing}\r\n          className={`\r\n                    relative w-36 h-36 md:w-40 md:h-40 rounded-full border-4 transition-all duration-300 flex items-center justify-center mx-auto\r\n                    ${\r\n                      status === \"connected\"\r\n                        ? \"border-red-500 bg-gradient-to-br from-red-50 to-red-100 shadow-lg shadow-red-200/50 animate-pulse\"\r\n                        : \"border-[#B57DFF] bg-gradient-to-br from-purple-50 to-purple-100 hover:from-50 hover:to-purple-100 shadow-lg hover:shadow-xl hover:scale-105\"\r\n                    }\r\n                    ${status === \"connected\" ? \"opacity-50\" : \"cursor-pointer\"}\r\n                  `}\r\n        >\r\n          {/* Microphone Icon */}\r\n          <svg\r\n            className={`w-18 h-18 md:w-20 md:h-20 transition-colors duration-300 ${\r\n              status === \"connected\" ? \"text-red-500\" : \"text-[#B57DFF]\"\r\n            }`}\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\r\n            />\r\n          </svg>\r\n\r\n          {/* Recording Animation Rings */}\r\n          {status === \"connected\" && (\r\n            <>\r\n              <div className=\"absolute inset-0 rounded-full border-4 border-red-300 animate-ping\"></div>\r\n              <div className=\"absolute inset-2 rounded-full border-4 border-red-200 animate-ping animation-delay-300\"></div>\r\n              <div className=\"absolute inset-4 rounded-full border-4 border-red-100 animate-ping animation-delay-600\"></div>\r\n            </>\r\n          )}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Instructions */}\r\n      <div className=\"mt-4 text-xs text-gray-600 text-center\">\r\n        {!hasPermission && (\r\n          <p className=\"text-[#B57DFF]\">\r\n             Microphone access is required for voice chat\r\n          </p>\r\n        )}\r\n        {status === \"connected\" && (\r\n          <p>Speak clearly and the agent will respond with voice</p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Minutes Modal */}\r\n      {showMinutesModal && (\r\n        <div className=\"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black/80 z-50\">\r\n          <div className=\"relative\">\r\n            {/* Close button */}\r\n            <button\r\n              onClick={() => setShowMinutesModal(false)}\r\n              className=\"absolute -top-2 -right-2 z-10 bg-red-500 hover:bg-red-600 rounded-full p-2 text-white transition-colors\"\r\n              title=\"Close\"\r\n            >\r\n              <svg\r\n                className=\"w-6 h-6\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M6 18L18 6M6 6l12 12\"\r\n                />\r\n              </svg>\r\n            </button>\r\n            <MinutesSection\r\n              userId={session?.user?.id || \"\"}\r\n              onPaymentSuccess={() => {\r\n                setShowMinutesModal(false);\r\n                setXeno(!xeno);\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Plans Modal */}\r\n      {showPlansModal && (\r\n        <div className=\"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black/80 z-50\">\r\n          <div className=\"relative\">\r\n            {/* Close button */}\r\n            <button\r\n              onClick={() => setShowPlansModal(false)}\r\n              className=\"absolute -top-2 -right-2 z-10 bg-red-500 hover:bg-red-600 rounded-full p-2 text-white transition-colors\"\r\n              title=\"Close\"\r\n            >\r\n              <svg\r\n                className=\"w-6 h-6\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M6 18L18 6M6 6l12 12\"\r\n                />\r\n              </svg>\r\n            </button>\r\n            {/* <MinutesSection\r\n              userId={parsedUserData?.id}\r\n              onPaymentSuccess={() => {setShowMinutesModal(false); setXeno(!xeno);}}\r\n            /> */}\r\n            <Plans\r\n              onPaymentSuccess={() => {\r\n                setShowPlansModal(false);\r\n                setXeno(!xeno);\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\home\\Banner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\home\\Founder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\home\\Mission.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\home\\Navbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":2,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isOpen' is assigned a value but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsOpen' is assigned a value but never used.","line":8,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":27},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":36,"column":22,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1263,1311],"text":"\r\n                  Let&apos;s Chat\r\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1263,1311],"text":"\r\n                  Let&lsquo;s Chat\r\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1263,1311],"text":"\r\n                  Let&#39;s Chat\r\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1263,1311],"text":"\r\n                  Let&rsquo;s Chat\r\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport Image from \"next/image\";\r\nimport Link from \"next/link\";\r\nimport { useSession } from \"next-auth/react\";\r\n\r\nexport default function NavbarBanner() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const { data: session } = useSession();\r\n\r\n  return (\r\n    <div className=\"w-full  \">\r\n      <header className=\"bg-[#FFB536] flex justify-between items-center px-4 sm:px-8 lg:px-16 py-3 md:py-4\">\r\n        {/* Logo */}\r\n        <div className=\"flex items-center space-x-2\">\r\n          {/* <span className=\"text-xl md:text-2xl\"></span>\r\n           */}\r\n          <Image\r\n            src=\"/footer.avif\" // replace with your logo\r\n            alt=\"Vet365 Logo\"\r\n            width={30}\r\n            height={30}\r\n            className=\"rounded-md\"\r\n          />\r\n          <span className=\"font-bold text-base md:text-lg tracking-wide\">\r\n            VET365.AI\r\n          </span>\r\n        </div>\r\n\r\n        {/* Right Actions */}\r\n        <div className=\"flex items-center space-x-3 md:space-x-5\">\r\n          {session?.user ? (\r\n            <div className=\"flex gap-3\">\r\n              <Link href=\"/chat\">\r\n                <button className=\"px-3 md:px-5 py-1.5 md:py-2 text-sm md:text-base font-medium\">\r\n                  Let's Chat\r\n                </button>\r\n              </Link>\r\n\r\n              <Link href=\"/profile\">\r\n                <button className=\"bg-black text-white px-3 md:px-5 py-1.5 md:py-2 rounded-full text-sm md:text-base font-medium transition hover:bg-[#FFB536] hover:text-black hover:shadow-2xl\">\r\n                  Profile\r\n                </button>\r\n              </Link>\r\n            </div>\r\n          ) : (\r\n            <Link href=\"/login\">\r\n              <button className=\"bg-black text-white px-3 md:px-5 py-1.5 md:py-2 rounded-full text-sm md:text-base font-medium hover:bg-gray-800 transition\">\r\n                Fetch Your Account\r\n              </button>\r\n            </Link>\r\n          )}\r\n        </div>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\home\\Plans.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StripeElementsOptions' is defined but never used.","line":5,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Elements' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stripePromise' is assigned a value but never used.","line":16,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardForm' is assigned a value but never used.","line":20,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2844,2847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2844,2847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":194,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5851,5854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5851,5854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6021,6024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6021,6024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6411,6414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6411,6414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/components/PricingPlans.tsx\r\n\"use client\";\r\nimport Image from \"next/image\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { loadStripe, StripeElementsOptions } from \"@stripe/stripe-js\";\r\nimport {\r\n  Elements,\r\n  CardElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport PaymentModal from \"@/app/components/payment/PaymentModal\";\r\nimport { useSession } from \"next-auth/react\";\r\n\r\nconst stripePromise = loadStripe(\r\n  process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!\r\n);\r\n\r\nconst CardForm = ({\r\n  minutes,\r\n  userId,\r\n  onClose,\r\n  clientSecret,\r\n}: {\r\n  minutes: string;\r\n  userId: string;\r\n  onClose: () => void;\r\n  clientSecret: string;\r\n}) => {\r\n  const stripe = useStripe();\r\n  const router = useRouter();\r\n  const elements = useElements();\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [cardholderName, setCardholderName] = useState(\"\");\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !elements || !cardholderName.trim() || !clientSecret) {\r\n      setError(\"Please fill in all fields\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const cardElement = elements.getElement(CardElement);\r\n\r\n      if (!cardElement) {\r\n        setError(\"Card element not found\");\r\n        return;\r\n      }\r\n\r\n      // Confirm the payment intent with card element\r\n      const { error: confirmError, paymentIntent } =\r\n        await stripe.confirmCardPayment(clientSecret, {\r\n          payment_method: {\r\n            card: cardElement,\r\n            billing_details: {\r\n              name: cardholderName,\r\n            },\r\n          },\r\n        });\r\n\r\n      if (confirmError) {\r\n        setError(confirmError.message || \"Payment confirmation failed\");\r\n        return;\r\n      }\r\n\r\n      if (paymentIntent && paymentIntent.status === \"succeeded\") {\r\n        // Process the successful payment\r\n        const response = await fetch(\"/api/minutes/purchased\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({\r\n            paymentIntentId: paymentIntent.id,\r\n            userId,\r\n          }),\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n          setError(data.error || \"Payment processing failed\");\r\n          return;\r\n        }\r\n\r\n        if (data.success) {\r\n          alert(\r\n            `Payment successful! ${data.minutesAdded} minutes have been added to your account.`\r\n          );\r\n          onClose();\r\n          router.refresh(); // Refresh to show updated minutes\r\n        } else {\r\n          setError(\"Payment processing failed\");\r\n        }\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"Payment error:\", err);\r\n      setError(\"An unexpected error occurred. Please try again.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          Cardholder Name\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          value={cardholderName}\r\n          onChange={(e) => setCardholderName(e.target.value)}\r\n          className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n          placeholder=\"John Doe\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          Card Information\r\n        </label>\r\n        <div className=\"p-3 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-orange-500 focus-within:border-transparent\">\r\n          <CardElement\r\n            options={{\r\n              style: {\r\n                base: {\r\n                  fontSize: \"16px\",\r\n                  color: \"#424770\",\r\n                  \"::placeholder\": {\r\n                    color: \"#aab7c4\",\r\n                  },\r\n                },\r\n              },\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\r\n          <div className=\"flex items-center\">\r\n            <svg\r\n              className=\"w-5 h-5 mr-2\"\r\n              fill=\"currentColor\"\r\n              viewBox=\"0 0 20 20\"\r\n            >\r\n              <path\r\n                fillRule=\"evenodd\"\r\n                d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\"\r\n                clipRule=\"evenodd\"\r\n              />\r\n            </svg>\r\n            {error}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-4 justify-center pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"px-6 py-3 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium transition-colors\"\r\n          disabled={loading}\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"px-6 py-3 rounded-lg bg-gradient-to-r from-[#B57DFF] to-[#ff8a1e] text-white font-semibold hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          disabled={loading || !stripe}\r\n        >\r\n          {loading ? \"Processing...\" : `Pay ${minutes}`}\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\ninterface PricingPlansProps {\r\n  onPaymentSuccess?: () => void;\r\n}\r\n\r\nexport default function PricingPlans({\r\n  onPaymentSuccess,\r\n}: PricingPlansProps = {}) {\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [selectedPlan, setSelectedPlan] = useState<any>(null);\r\n  const { data: session } = useSession();\r\n\r\n  // Get userId from session\r\n  const userId = session?.user?.id || \"\";\r\n\r\n  const [plans, setPlans] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/plans\")\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        setPlans(data);\r\n        setLoading(false);\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Failed to fetch plans\", err);\r\n        setLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  const openModal = (plan: any) => {\r\n    setSelectedPlan(plan);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  if (loading) return <div className=\"text-center py-20\">Loading plans...</div>;\r\n\r\n  return (\r\n    <section className=\"w-full bg-[#B57DFF] py-16 px-6\" id=\"plans\">\r\n      <div className=\"max-w-4xl mx-auto text-center\">\r\n        {/* Heading */}\r\n        <h2 className=\"text-[42px] md:text-[64px] font-extrabold leading-tight text-black text-start\">\r\n          Choose the Right Plan for <span className=\"\">You & Your Pet</span>\r\n        </h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 max-w-6xl w-full mx-auto mt-6\">\r\n          {plans.map((plan) => (\r\n            <div\r\n              key={plan._id}\r\n              className={`${\r\n                plan.name.toLowerCase().includes(\"sniff\")\r\n                  ? \"bg-[#ffb930]\"\r\n                  : \"bg-[#47e5d2]\"\r\n              } rounded-3xl p-8 md:p-12 text-black shadow-lg flex flex-col justify-between`}\r\n            >\r\n              <div>\r\n                <h2 className=\"text-[24px] md:text-[28px] font-extrabold mb-2 \">\r\n                  {plan.name}\r\n                </h2>\r\n                <div className=\"border-b border-black w-70 mb-6\"></div>\r\n\r\n                <p className=\"text-[16px] md:text-[18px] leading-relaxed mb-4\">\r\n                  {plan.description}\r\n                </p>\r\n                <div className=\"border-b border-black w-70 mb-6\"></div>\r\n\r\n                <ul className=\"space-y-2 text-[16px] md:text-[18px] leading-relaxed mt-4\">\r\n                  {plan.features.map((feature: string, index: number) => (\r\n                    <li key={index}>{feature}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n\r\n              <div className=\"mt-8\">\r\n                <p className=\"text-[20px] md:text-[22px] font-bold mb-4\">\r\n                  ${(plan.price / 100).toFixed(2)}/\r\n                  {plan.interval === \"month\" ? \"mo\" : \"yr\"}\r\n                </p>\r\n                <button\r\n                  onClick={() => openModal(plan)}\r\n                  className=\"bg-black text-white px-6 py-3 rounded-full font-semibold text-[16px] hover:bg-gray-900 transition\"\r\n                >\r\n                  {plan.interval === \"month\" ? \"Join the Pack\" : \"Sniff It Out\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Modal */}\r\n      <PaymentModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        plan={selectedPlan}\r\n        userId={userId}\r\n        onPaymentSuccess={onPaymentSuccess}\r\n      />\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\layout\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\payment\\Packages.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[732,735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[732,735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[788,791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[788,791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\fiver_projects\\petcare\\app\\components\\payment\\Packages.tsx:28:7\n  26 |   useEffect(() => {\n  27 |     if (session?.user?.total_time !== undefined) {\n> 28 |       setCurrentMinutes(session.user.total_time);\n     |       ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  29 |     }\n  30 |   }, [session?.user?.total_time]);\n  31 |","line":28,"column":7,"nodeType":null,"endLine":28,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1394,1397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1394,1397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useSession } from \"next-auth/react\";\r\nimport { BsLightning, BsPlus } from \"react-icons/bs\";\r\nimport PackagesPaymentModal from \"@/app/components/payment/PackagesPaymentModal\";\r\n\r\ninterface MinutesSectionProps {\r\n  userId: string;\r\n  currentMinutes: number;\r\n  onPaymentSuccess?: () => void;\r\n}\r\n\r\nexport default function Packages({\r\n  userId,\r\n  currentMinutes: initialMinutes,\r\n  onPaymentSuccess,\r\n}: MinutesSectionProps) {\r\n  const { data: session } = useSession();\r\n  const [currentMinutes, setCurrentMinutes] = useState(initialMinutes || 0);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [selectedPackage, setSelectedPackage] = useState<any>(null);\r\n  const [packages, setPackages] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Update minutes from session\r\n  useEffect(() => {\r\n    if (session?.user?.total_time !== undefined) {\r\n      setCurrentMinutes(session.user.total_time);\r\n    }\r\n  }, [session?.user?.total_time]);\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/packages\")\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        setPackages(data);\r\n        setLoading(false);\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Failed to fetch packages\", err);\r\n        setLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  const handlePurchase = (pkg: any) => {\r\n    setSelectedPackage(pkg);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setIsModalOpen(false);\r\n    setSelectedPackage(null);\r\n  };\r\n\r\n  const handlePaymentSuccess = () => {\r\n    // Trigger parent callback to refresh data\r\n    onPaymentSuccess?.();\r\n    closeModal();\r\n  };\r\n\r\n  if (loading)\r\n    return <div className=\"text-center py-10\">Loading packages...</div>;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"mb-8\">\r\n        {/* Purchase Minutes Section */}\r\n        <div className=\"relative rounded-sm bg-[#B57DFF] backdrop-blur-xl overflow-hidden\">\r\n          <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n          <div className=\"p-6\">\r\n            <div className=\"text-center mb-6\">\r\n              <h2 className=\"text-2xl font-bold text-white mb-2\">\r\n                Add Minutes To Your Account\r\n              </h2>\r\n              <p className=\"text-slate-600\">\r\n                Add minutes to your account for AI-powered pet care\r\n                consultations. You currently have {currentMinutes || 0} minutes\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-3 gap-4 mt-10\">\r\n              {packages.map((pkg) => (\r\n                <div\r\n                  key={pkg._id}\r\n                  className={`relative rounded-xl shadow-xl px-6 pb-6 pt-8 mt-8 md:mt-4 transition-all cursor-pointer bg-gradient-to-r from-purple-50 to-purple-100 hover:scale-105`}\r\n                  onClick={() => handlePurchase(pkg)}\r\n                >\r\n                  {pkg.isPopular && (\r\n                    <div className=\"absolute -top-3 left-1/2 transform -translate-x-1/2\">\r\n                      <div className=\"bg-black text-white px-3 py-1 rounded-full text-xs font-semibold flex items-center\">\r\n                        <BsLightning className=\"w-3 h-3 mr-1\" />\r\n                        Most Popular\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"text-center\">\r\n                    <h3 className=\"text-xl font-bold text-slate-900 mb-2\">\r\n                      {pkg.minutes} Minutes\r\n                    </h3>\r\n\r\n                    <div className=\"text-3xl font-bold text-black mb-2\">\r\n                      ${(pkg.price / 100).toFixed(2)}\r\n                    </div>\r\n\r\n                    <p className=\"text-sm text-slate-600 mb-4\">\r\n                      {pkg.description}\r\n                    </p>\r\n\r\n                    <button\r\n                      className={`w-full py-3 px-4 rounded-lg font-semibold transition-all ${\r\n                        pkg.isPopular\r\n                          ? \"bg-black text-white hover:bg-[#FFB536] hover:text-black\"\r\n                          : \"bg-black text-white hover:bg-[#FFB536] hover:text-black\"\r\n                      }`}\r\n                    >\r\n                      <BsPlus className=\"w-5 h-5 inline mr-2\" />\r\n                      Add Minutes\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Modal */}\r\n      <PackagesPaymentModal\r\n        isOpen={isModalOpen}\r\n        onClose={closeModal}\r\n        pkg={selectedPackage}\r\n        userId={userId}\r\n        onPaymentSuccess={handlePaymentSuccess}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\payment\\PackagesPaymentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[579,582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[579,582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[979,982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[979,982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4868,4871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4868,4871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10582,10585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10582,10585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingPaymentMethods' is assigned a value but never used.","line":338,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":338,"endColumn":31},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\fiver_projects\\petcare\\app\\components\\payment\\PackagesPaymentModal.tsx:371:7\n  369 |   useEffect(() => {\n  370 |     if (isOpen && userId && userId.trim() !== \"\") {\n> 371 |       setLoadingPaymentMethods(true);\n      |       ^^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  372 |       fetch(\"/api/payments/get-payment-methods\", {\n  373 |         method: \"POST\",\n  374 |         headers: { \"Content-Type\": \"application/json\" },","line":371,"column":7,"nodeType":null,"endLine":371,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'options'. Either include it or remove the dependency array.","line":402,"column":50,"nodeType":"ArrayExpression","endLine":402,"endColumn":64,"suggestions":[{"desc":"Update the dependencies array to be: [options]","fix":{"range":[12909,12923],"text":"[options]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport Swal from \"sweetalert2\";\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { loadStripe, StripeElementsOptions } from \"@stripe/stripe-js\";\r\nimport {\r\n  Elements,\r\n  CardElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { BsClock, BsX } from \"react-icons/bs\";\r\n\r\n// Initialize Stripe\r\nconst stripePromise = loadStripe(\r\n  process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!\r\n);\r\n\r\ninterface PackagesPaymentModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  pkg: any;\r\n  userId: string;\r\n  onPaymentSuccess?: () => void;\r\n}\r\n\r\nconst CardForm = ({\r\n  pkg,\r\n  userId,\r\n  onClose,\r\n  clientSecret,\r\n  onPaymentSuccess,\r\n  paymentMethods,\r\n  useNewCard,\r\n  setUseNewCard,\r\n  selectedPaymentMethod,\r\n  setSelectedPaymentMethod,\r\n}: {\r\n  pkg: any;\r\n  userId: string;\r\n  onClose: () => void;\r\n  clientSecret: string;\r\n  onPaymentSuccess?: () => void;\r\n  paymentMethods: any[];\r\n  useNewCard: boolean;\r\n  setUseNewCard: (value: boolean) => void;\r\n  selectedPaymentMethod: string;\r\n  setSelectedPaymentMethod: (value: string) => void;\r\n}) => {\r\n  const stripe = useStripe();\r\n  const router = useRouter();\r\n  const elements = useElements();\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [cardholderName, setCardholderName] = useState(\"\");\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !clientSecret) {\r\n      setError(\"Payment system not ready\");\r\n      return;\r\n    }\r\n\r\n    // Validate based on payment method choice\r\n    if (useNewCard) {\r\n      if (!elements || !cardholderName.trim()) {\r\n        setError(\"Please fill in all fields\");\r\n        return;\r\n      }\r\n\r\n      const cardElement = elements.getElement(CardElement);\r\n      if (!cardElement) {\r\n        setError(\"Card element not found\");\r\n        return;\r\n      }\r\n    } else {\r\n      if (!selectedPaymentMethod) {\r\n        setError(\"Please select a payment method\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      let paymentIntent;\r\n\r\n      if (useNewCard) {\r\n        // Confirm the payment intent with new card element\r\n        const cardElement = elements?.getElement(CardElement);\r\n\r\n        if (!cardElement) {\r\n          setError(\"Card element not found\");\r\n          return;\r\n        }\r\n\r\n        const { error: confirmError, paymentIntent: pi } =\r\n          await stripe.confirmCardPayment(clientSecret, {\r\n            payment_method: {\r\n              card: cardElement!,\r\n              billing_details: {\r\n                name: cardholderName,\r\n              },\r\n            },\r\n          });\r\n\r\n        if (confirmError) {\r\n          console.error(\"Stripe confirmation error:\", confirmError);\r\n          setError(confirmError.message || \"Payment confirmation failed\");\r\n          return;\r\n        }\r\n\r\n        paymentIntent = pi;\r\n      } else {\r\n        // Confirm the payment intent with saved payment method\r\n        const { error: confirmError, paymentIntent: pi } =\r\n          await stripe.confirmCardPayment(clientSecret, {\r\n            payment_method: selectedPaymentMethod,\r\n          });\r\n\r\n        if (confirmError) {\r\n          setError(confirmError.message || \"Payment confirmation failed\");\r\n          return;\r\n        }\r\n\r\n        paymentIntent = pi;\r\n      }\r\n\r\n      if (paymentIntent && paymentIntent.status === \"succeeded\") {\r\n        // Process the successful payment\r\n        const response = await fetch(\"/api/payments/checkout\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({\r\n            paymentIntentId: paymentIntent.id,\r\n            userId,\r\n            total_time: pkg.minutes.toString(), // Pass minutes to add\r\n          }),\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n          setError(data.error || \"Payment processing failed\");\r\n          return;\r\n        }\r\n\r\n        if (data.success) {\r\n          // Close modal immediately after successful payment\r\n          onClose();\r\n          onPaymentSuccess?.(); // Trigger parent callback to refresh session\r\n          router.refresh(); // Refresh to show updated minutes\r\n\r\n          // Show success message after modal is closed\r\n          setTimeout(() => {\r\n            Swal.fire({\r\n              icon: \"success\",\r\n              title: \"Payment Successful!\",\r\n              text: `${data.minutesAdded} minutes have been added to your account.`,\r\n              timer: 3000,\r\n              timerProgressBar: true,\r\n              showConfirmButton: false,\r\n            });\r\n          }, 100);\r\n        } else {\r\n          setError(\"Payment processing failed\");\r\n        }\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"Payment error:\", err);\r\n      setError(\"An unexpected error occurred. Please try again.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      {/* Payment Method Selection */}\r\n      {paymentMethods.length > 0 && (\r\n        <div className=\"space-y-3\">\r\n          <label className=\"block text-sm font-medium text-gray-700\">\r\n            Payment Method\r\n          </label>\r\n\r\n          {/* Toggle between saved methods and new card */}\r\n          <div className=\"flex gap-4 mb-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setUseNewCard(false)}\r\n              className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n                !useNewCard\r\n                  ? \"bg-purple-500 text-white\"\r\n                  : \"bg-gray-200 text-gray-700 hover:bg-gray-300\"\r\n              }`}\r\n            >\r\n              Use Saved Card\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setUseNewCard(true)}\r\n              className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n                useNewCard\r\n                  ? \"bg-purple-500 text-white\"\r\n                  : \"bg-gray-200 text-gray-700 hover:bg-gray-300\"\r\n              }`}\r\n            >\r\n              Use New Card\r\n            </button>\r\n          </div>\r\n\r\n          {/* Saved Payment Methods */}\r\n          {!useNewCard && (\r\n            <div className=\"space-y-2\">\r\n              {paymentMethods.slice(0, 2).map((pm) => (\r\n                <label\r\n                  key={pm.id}\r\n                  className=\"flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50\"\r\n                >\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"paymentMethod\"\r\n                    value={pm.id}\r\n                    checked={selectedPaymentMethod === pm.id}\r\n                    onChange={(e) => setSelectedPaymentMethod(e.target.value)}\r\n                    className=\"mr-3 text-[#B57DFF] focus:ring-orange-500\"\r\n                  />\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"font-medium capitalize\">\r\n                      {pm.card.brand} ending in {pm.card.last4}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      Expires {pm.card.exp_month}/{pm.card.exp_year}\r\n                    </div>\r\n                  </div>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* New Card Form */}\r\n      {useNewCard && (\r\n        <>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Cardholder Name\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={cardholderName}\r\n              onChange={(e) => setCardholderName(e.target.value)}\r\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n              placeholder=\"John Doe\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Card Information\r\n            </label>\r\n            <div className=\"p-3 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-orange-500 focus-within:border-transparent\">\r\n              <CardElement\r\n                options={{\r\n                  style: {\r\n                    base: {\r\n                      fontSize: \"16px\",\r\n                      color: \"#424770\",\r\n                      \"::placeholder\": {\r\n                        color: \"#aab7c4\",\r\n                      },\r\n                    },\r\n                  },\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {error && (\r\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\r\n          <div className=\"flex items-center\">\r\n            <svg\r\n              className=\"w-5 h-5 mr-2\"\r\n              fill=\"currentColor\"\r\n              viewBox=\"0 0 20 20\"\r\n            >\r\n              <path\r\n                fillRule=\"evenodd\"\r\n                d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\"\r\n                clipRule=\"evenodd\"\r\n              />\r\n            </svg>\r\n            {error}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-4 justify-center pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"px-6 py-3 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium transition-colors\"\r\n          disabled={loading}\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"px-6 py-3 rounded-lg bg-gradient-to-r from-[#B57DFF] to-[#ff8a1e] text-white font-semibold hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          disabled={loading || (!useNewCard && !selectedPaymentMethod)}\r\n        >\r\n          {loading ? \"Processing...\" : `Pay $${(pkg.price / 100).toFixed(2)}`}\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default function PackagesPaymentModal({\r\n  isOpen,\r\n  onClose,\r\n  pkg,\r\n  userId,\r\n  onPaymentSuccess,\r\n}: PackagesPaymentModalProps) {\r\n  const router = useRouter();\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [paymentMethods, setPaymentMethods] = useState<any[]>([]);\r\n  const [useNewCard, setUseNewCard] = useState(false);\r\n  const [selectedPaymentMethod, setSelectedPaymentMethod] =\r\n    useState<string>(\"\");\r\n  const [loadingPaymentMethods, setLoadingPaymentMethods] = useState(false);\r\n\r\n  // Redirect to login if userId is empty\r\n  useEffect(() => {\r\n    if (isOpen && (!userId || userId.trim() === \"\")) {\r\n      alert(\"Please log in to purchase minutes\");\r\n      router.push(\"/login\");\r\n      onClose();\r\n      return;\r\n    }\r\n  }, [isOpen, userId, router, onClose]);\r\n\r\n  useEffect(() => {\r\n    // Create PaymentIntent as soon as the modal opens\r\n    if (isOpen && pkg && userId && userId.trim() !== \"\") {\r\n      fetch(\"/api/payments/create-payment-intent\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ minutes: pkg.minutes.toString(), userId }), // Pass minutes as string\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          if (data.clientSecret) {\r\n            setClientSecret(data.clientSecret);\r\n          }\r\n        })\r\n        .catch((err) => console.error(\"Failed to create payment intent:\", err));\r\n    }\r\n  }, [isOpen, pkg, userId]);\r\n\r\n  // Fetch payment methods when modal opens\r\n  useEffect(() => {\r\n    if (isOpen && userId && userId.trim() !== \"\") {\r\n      setLoadingPaymentMethods(true);\r\n      fetch(\"/api/payments/get-payment-methods\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ userId }),\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          if (data.paymentMethods) {\r\n            setPaymentMethods(data.paymentMethods);\r\n            if (data.paymentMethods.length > 0) {\r\n              setSelectedPaymentMethod(data.paymentMethods[0].id);\r\n              setUseNewCard(false);\r\n            } else {\r\n              setUseNewCard(true);\r\n            }\r\n          }\r\n        })\r\n        .catch((err) => console.error(\"Failed to fetch payment methods:\", err))\r\n        .finally(() => setLoadingPaymentMethods(false));\r\n    }\r\n  }, [isOpen, userId]);\r\n\r\n  const options: StripeElementsOptions = {\r\n    clientSecret,\r\n    appearance: {\r\n      theme: \"stripe\",\r\n      labels: \"floating\",\r\n    },\r\n  };\r\n\r\n  const memoizedOptions = useMemo(() => options, [clientSecret]);\r\n\r\n  if (!isOpen || !pkg) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full relative\">\r\n        {/* Close button */}\r\n        <button\r\n          onClick={onClose}\r\n          className=\"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors\"\r\n        >\r\n          <BsX className=\"w-6 h-6\" />\r\n        </button>\r\n\r\n        <div className=\"text-center mb-6\">\r\n          <div className=\"w-16 h-16 mx-auto mb-4 bg-purple-100 rounded-full flex items-center justify-center\">\r\n            <BsClock className=\"w-8 h-8 text-[#B57DFF]\" />\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold mb-2\">Add {pkg.minutes} Minutes</h2>\r\n          <p className=\"text-gray-600 mb-2\">${(pkg.price / 100).toFixed(2)}</p>\r\n          <p className=\"text-sm text-gray-500\">{pkg.description}</p>\r\n        </div>\r\n\r\n        {clientSecret ? (\r\n          <Elements options={memoizedOptions} stripe={stripePromise}>\r\n            <CardForm\r\n              pkg={pkg}\r\n              userId={userId}\r\n              onClose={onClose}\r\n              clientSecret={clientSecret}\r\n              onPaymentSuccess={onPaymentSuccess}\r\n              paymentMethods={paymentMethods}\r\n              useNewCard={useNewCard}\r\n              setUseNewCard={setUseNewCard}\r\n              selectedPaymentMethod={selectedPaymentMethod}\r\n              setSelectedPaymentMethod={setSelectedPaymentMethod}\r\n            />\r\n          </Elements>\r\n        ) : (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto\"></div>\r\n            <p className=\"mt-2 text-gray-600\">Preparing payment form...</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\components\\payment\\PaymentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Swal' is defined but never used.","line":11,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[798,801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[798,801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[890,893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[890,893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4347,4350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4347,4350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10035,10038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10035,10038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingPaymentMethods' is assigned a value but never used.","line":323,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":323,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentPlan' is assigned a value but never used.","line":324,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":324,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":324,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10319,10322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10319,10322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\fiver_projects\\petcare\\app\\components\\payment\\PaymentModal.tsx:338:7\n  336 |     // Create PaymentIntent as soon as the modal opens\n  337 |     if (isOpen && plan && userId && userId.trim() !== \"\") {\n> 338 |       setCurrentPlan(plan);\n      |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  339 |       fetch(\"/api/payments/create-payment-intent\", {\n  340 |         method: \"POST\",\n  341 |         headers: { \"Content-Type\": \"application/json\" },","line":338,"column":7,"nodeType":null,"endLine":338,"endColumn":21},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\fiver_projects\\petcare\\app\\components\\payment\\PaymentModal.tsx:357:7\n  355 |   useEffect(() => {\n  356 |     if (isOpen && userId && userId.trim() !== \"\") {\n> 357 |       setLoadingPaymentMethods(true);\n      |       ^^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  358 |       fetch(\"/api/payments/get-payment-methods\", {\n  359 |         method: \"POST\",\n  360 |         headers: { \"Content-Type\": \"application/json\" },","line":357,"column":7,"nodeType":null,"endLine":357,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'options'. Either include it or remove the dependency array.","line":389,"column":50,"nodeType":"ArrayExpression","endLine":389,"endColumn":64,"suggestions":[{"desc":"Update the dependencies array to be: [options]","fix":{"range":[12434,12448],"text":"[options]"}}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { loadStripe, StripeElementsOptions } from \"@stripe/stripe-js\";\r\nimport {\r\n  Elements,\r\n  CardElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Swal from \"sweetalert2\";\r\n// Initialize Stripe\r\nconst stripePromise = loadStripe(\r\n  process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!\r\n);\r\n\r\ninterface PaymentModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  plan: any;\r\n  userId: string;\r\n  onPaymentSuccess?: () => void;\r\n}\r\n\r\nconst CardForm = ({\r\n  plan,\r\n  userId,\r\n  onClose,\r\n  clientSecret,\r\n  paymentMethods,\r\n  useNewCard,\r\n  setUseNewCard,\r\n  selectedPaymentMethod,\r\n  setSelectedPaymentMethod,\r\n  onPaymentSuccess,\r\n}: {\r\n  plan: any;\r\n  userId: string;\r\n  onClose: () => void;\r\n  clientSecret: string;\r\n  paymentMethods: any[];\r\n  useNewCard: boolean;\r\n  setUseNewCard: (value: boolean) => void;\r\n  selectedPaymentMethod: string;\r\n  setSelectedPaymentMethod: (value: string) => void;\r\n  onPaymentSuccess?: () => void;\r\n}) => {\r\n  const stripe = useStripe();\r\n  const router = useRouter();\r\n  const elements = useElements();\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [cardholderName, setCardholderName] = useState(\"\");\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !clientSecret) {\r\n      setError(\"Payment system not ready\");\r\n      return;\r\n    }\r\n\r\n    // Validate based on payment method choice\r\n    if (useNewCard) {\r\n      if (!elements || !cardholderName.trim()) {\r\n        setError(\"Please fill in all fields\");\r\n        return;\r\n      }\r\n\r\n      const cardElement = elements.getElement(CardElement);\r\n      if (!cardElement) {\r\n        setError(\"Card element not found\");\r\n        return;\r\n      }\r\n    } else {\r\n      if (!selectedPaymentMethod) {\r\n        setError(\"Please select a payment method\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      let paymentIntent;\r\n\r\n      if (useNewCard) {\r\n        // Confirm the payment intent with new card element\r\n        if (!elements) {\r\n          setError(\"Payment elements not ready\");\r\n          return;\r\n        }\r\n\r\n        const cardElement = elements.getElement(CardElement);\r\n\r\n        const { error: confirmError, paymentIntent: pi } =\r\n          await stripe.confirmCardPayment(clientSecret, {\r\n            payment_method: {\r\n              card: cardElement!,\r\n              billing_details: {\r\n                name: cardholderName,\r\n              },\r\n            },\r\n          });\r\n\r\n        if (confirmError) {\r\n          setError(confirmError.message || \"Payment confirmation failed\");\r\n          return;\r\n        }\r\n\r\n        paymentIntent = pi;\r\n      } else {\r\n        // Confirm the payment intent with saved payment method\r\n        const { error: confirmError, paymentIntent: pi } =\r\n          await stripe.confirmCardPayment(clientSecret, {\r\n            payment_method: selectedPaymentMethod,\r\n          });\r\n\r\n        if (confirmError) {\r\n          setError(confirmError.message || \"Payment confirmation failed\");\r\n          return;\r\n        }\r\n\r\n        paymentIntent = pi;\r\n      }\r\n\r\n      if (paymentIntent && paymentIntent.status === \"succeeded\") {\r\n        // Process the successful payment\r\n        const response = await fetch(\"/api/payments/checkout\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({\r\n            paymentIntentId: paymentIntent.id,\r\n            userId,\r\n            planId: plan._id, // Send plan ID for reference\r\n          }),\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n          setError(data.error || \"Payment processing failed\");\r\n          return;\r\n        }\r\n\r\n        if (data.success) {\r\n          // alert(\"Payment successful! Your subscription is now active.\");\r\n          onClose();\r\n          onPaymentSuccess?.(); // Call the callback to close the modal in VoiceChat\r\n          router.push(\"/chat\"); // Refresh to show updated subscription status\r\n        } else {\r\n          setError(\"Payment processing failed\");\r\n        }\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"Payment error:\", err);\r\n      setError(\"An unexpected error occurred. Please try again.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      {/* Payment Method Selection */}\r\n      {paymentMethods.length > 0 && (\r\n        <div className=\"space-y-3\">\r\n          <label className=\"block text-sm font-medium text-gray-700\">\r\n            Payment Method\r\n          </label>\r\n\r\n          {/* Toggle between saved methods and new card */}\r\n          <div className=\"flex gap-4 mb-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setUseNewCard(false)}\r\n              className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n                !useNewCard\r\n                  ? \"bg-purple-500 text-white\"\r\n                  : \"bg-gray-200 text-gray-700 hover:bg-gray-300\"\r\n              }`}\r\n            >\r\n              Use Saved Card\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setUseNewCard(true)}\r\n              className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n                useNewCard\r\n                  ? \"bg-purple-500 text-white\"\r\n                  : \"bg-gray-200 text-gray-700 hover:bg-gray-300\"\r\n              }`}\r\n            >\r\n              Use New Card\r\n            </button>\r\n          </div>\r\n\r\n          {/* Saved Payment Methods */}\r\n          {!useNewCard && (\r\n            <div className=\"space-y-2\">\r\n              {paymentMethods.map((pm) => (\r\n                <label\r\n                  key={pm.id}\r\n                  className=\"flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50\"\r\n                >\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"paymentMethod\"\r\n                    value={pm.id}\r\n                    checked={selectedPaymentMethod === pm.id}\r\n                    onChange={(e) => setSelectedPaymentMethod(e.target.value)}\r\n                    className=\"mr-3 text-[#B57DFF] focus:ring-orange-500\"\r\n                  />\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"font-medium capitalize\">\r\n                      {pm.card.brand} ending in {pm.card.last4}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      Expires {pm.card.exp_month}/{pm.card.exp_year}\r\n                    </div>\r\n                  </div>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* New Card Form */}\r\n      {useNewCard && (\r\n        <>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Cardholder Name\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={cardholderName}\r\n              onChange={(e) => setCardholderName(e.target.value)}\r\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n              placeholder=\"John Doe\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Card Information\r\n            </label>\r\n            <div className=\"p-3 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-orange-500 focus-within:border-transparent\">\r\n              <CardElement\r\n                options={{\r\n                  style: {\r\n                    base: {\r\n                      fontSize: \"16px\",\r\n                      color: \"#424770\",\r\n                      \"::placeholder\": {\r\n                        color: \"#aab7c4\",\r\n                      },\r\n                    },\r\n                  },\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {error && (\r\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\r\n          <div className=\"flex items-center\">\r\n            <svg\r\n              className=\"w-5 h-5 mr-2\"\r\n              fill=\"currentColor\"\r\n              viewBox=\"0 0 20 20\"\r\n            >\r\n              <path\r\n                fillRule=\"evenodd\"\r\n                d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 001 1V6a1 1 0 00-1-1z\"\r\n                clipRule=\"evenodd\"\r\n              />\r\n            </svg>\r\n            {error}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-4 justify-center pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"px-6 py-3 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium transition-colors\"\r\n          disabled={loading}\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"px-6 py-3 rounded-lg bg-gradient-to-r from-[#B57DFF] to-[#ff8a1e] text-white font-semibold hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          disabled={loading || (!useNewCard && !selectedPaymentMethod)}\r\n        >\r\n          {loading ? \"Processing...\" : `Pay $${(plan.price / 100).toFixed(2)}`}\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default function PaymentModal({\r\n  isOpen,\r\n  onClose,\r\n  plan,\r\n  userId,\r\n  onPaymentSuccess,\r\n}: PaymentModalProps) {\r\n  const router = useRouter();\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [paymentMethods, setPaymentMethods] = useState<any[]>([]);\r\n  const [useNewCard, setUseNewCard] = useState(false);\r\n  const [selectedPaymentMethod, setSelectedPaymentMethod] =\r\n    useState<string>(\"\");\r\n  const [loadingPaymentMethods, setLoadingPaymentMethods] = useState(false);\r\n  const [currentPlan, setCurrentPlan] = useState<any>(null);\r\n\r\n  // Redirect to login if userId is empty\r\n  useEffect(() => {\r\n    if (isOpen && (!userId || userId.trim() === \"\")) {\r\n      router.push(\"/signup\");\r\n      onClose();\r\n      return;\r\n    }\r\n  }, [isOpen, userId, router, onClose]);\r\n\r\n  useEffect(() => {\r\n    // Create PaymentIntent as soon as the modal opens\r\n    if (isOpen && plan && userId && userId.trim() !== \"\") {\r\n      setCurrentPlan(plan);\r\n      fetch(\"/api/payments/create-payment-intent\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ plan: plan._id, userId }), // Send plan ID\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          if (data.clientSecret) {\r\n            setClientSecret(data.clientSecret);\r\n          }\r\n        })\r\n        .catch((err) => console.error(\"Failed to create payment intent:\", err));\r\n    }\r\n  }, [isOpen, plan, userId]);\r\n\r\n  // Fetch payment methods when modal opens\r\n  useEffect(() => {\r\n    if (isOpen && userId && userId.trim() !== \"\") {\r\n      setLoadingPaymentMethods(true);\r\n      fetch(\"/api/payments/get-payment-methods\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ userId }),\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          if (data.paymentMethods) {\r\n            setPaymentMethods(data.paymentMethods);\r\n            if (data.paymentMethods.length > 0) {\r\n              setSelectedPaymentMethod(data.paymentMethods[0].id);\r\n              setUseNewCard(false);\r\n            } else {\r\n              setUseNewCard(true);\r\n            }\r\n          }\r\n        })\r\n        .catch((err) => console.error(\"Failed to fetch payment methods:\", err))\r\n        .finally(() => setLoadingPaymentMethods(false));\r\n    }\r\n  }, [isOpen, userId]);\r\n\r\n  const options: StripeElementsOptions = {\r\n    clientSecret,\r\n    appearance: {\r\n      theme: \"stripe\",\r\n      labels: \"floating\",\r\n    },\r\n  };\r\n\r\n  // Memoize options to prevent unnecessary re-renders\r\n  const memoizedOptions = useMemo(() => options, [clientSecret]);\r\n\r\n  if (!isOpen || !plan) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 z-50 p-4 flex justify-center items-center w-full h-full\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full\">\r\n        <div className=\"text-center mb-6\">\r\n          <h2 className=\"text-2xl font-bold mb-2\">Subscribe to {plan.name}</h2>\r\n          <p className=\"text-gray-600\">\r\n            ${(plan.price / 100).toFixed(2)}/\r\n            {plan.interval === \"month\" ? \"month\" : \"year\"}\r\n          </p>\r\n        </div>\r\n\r\n        {clientSecret ? (\r\n          <Elements options={memoizedOptions} stripe={stripePromise}>\r\n            <CardForm\r\n              plan={plan}\r\n              userId={userId}\r\n              onClose={onClose}\r\n              clientSecret={clientSecret}\r\n              paymentMethods={paymentMethods}\r\n              useNewCard={useNewCard}\r\n              setUseNewCard={setUseNewCard}\r\n              selectedPaymentMethod={selectedPaymentMethod}\r\n              setSelectedPaymentMethod={setSelectedPaymentMethod}\r\n              onPaymentSuccess={onPaymentSuccess}\r\n            />\r\n          </Elements>\r\n        ) : (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto\"></div>\r\n            <p className=\"mt-2 text-gray-600\">Preparing payment form...</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\fonts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\login\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":24,"column":20,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1329,1369],"text":"\r\n                Don&apos;t have an account?"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1329,1369],"text":"\r\n                Don&lsquo;t have an account?"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1329,1369],"text":"\r\n                Don&#39;t have an account?"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1329,1369],"text":"\r\n                Don&rsquo;t have an account?"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import AuthForm from \"@/app/components/auth/AuthForm\";\r\nimport Link from \"next/link\";\r\n\r\nexport const metadata = {\r\n  title: \"Log in - PetCare\",\r\n};\r\n\r\nexport default function LoginPage() {\r\n  return (\r\n    <section className=\"relative min-h-screen flex items-center justify-center overflow-hidden bg-[radial-gradient(1200px_600px_at_80%_-10%,#ffe7d6,transparent),radial-gradient(1000px_500px_at_-10%_10%,#fff0e5,transparent)]\">\r\n      {/* Decorative blurred orbs */}\r\n      <div className=\"pointer-events-none absolute -top-10 -left-10 h-72 w-72 rounded-full bg-[#ff8a1e]/20 blur-3xl\" />\r\n      <div className=\"pointer-events-none absolute -bottom-16 -right-10 h-80 w-80 rounded-full bg-[#B57DFF]/20 blur-3xl\" />\r\n\r\n      <div className=\"relative w-full px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"mx-auto max-w-xl\">\r\n          {/* Glass card */}\r\n          <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow-[0_10px_40px_rgba(0,0,0,0.08)]\">\r\n            {/* subtle top highlight */}\r\n            <div className=\"pointer-events-none absolute inset-x-0 -top-px h-px bg-gradient-to-r from-white/40 via-white/70 to-white/40\" />\r\n            <div className=\"p-8 sm:p-10\">\r\n              <AuthForm mode=\"login\" />\r\n              <p className=\"mt-6 text-center text-sm text-slate-600\">\r\n                Don't have an account?{\" \"}\r\n                <Link\r\n                  href=\"/register\"\r\n                  className=\"font-semibold text-[#B57DFF] hover:text-[#B57DFF]\"\r\n                >\r\n                  Sign up\r\n                </Link>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BsClock' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[565,568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[565,568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[923,926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[923,926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingSubscription' is assigned a value but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":29},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":255,"column":19,"nodeType":"JSXOpeningElement","endLine":259,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport {\r\n  BsCreditCard,\r\n  BsClock,\r\n  BsCheckCircle,\r\n  BsPlus,\r\n  BsChat,\r\n} from \"react-icons/bs\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useSession, signOut } from \"next-auth/react\";\r\nimport ChatMenu from \"../components/chat/ChatMenu\";\r\nimport PaymentModal from \"../components/payment/PaymentModal\";\r\n\r\nexport default function ProfilePage() {\r\n  const { data: session, status } = useSession();\r\n  const [paymentMethods, setPaymentMethods] = useState<any[]>([]);\r\n  const [loadingPaymentMethods, setLoadingPaymentMethods] = useState(false);\r\n  const [updatingRenewal, setUpdatingRenewal] = useState(false);\r\n  const [uploadingImage, setUploadingImage] = useState(false);\r\n  const [profileImage, setProfileImage] = useState<string | null>(null);\r\n  const [latestSubscription, setLatestSubscription] = useState<any>(null);\r\n  const [loadingSubscription, setLoadingSubscription] = useState(false);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [remainingMinutes, setRemainingMinutes] = useState(0);\r\n  const [selectedPlan, setSelectedPlan] = useState<\r\n    \"basic\" | \"premium\" | \"professional\" | null\r\n  >(null);\r\n\r\n  const router = useRouter();\r\n\r\n  const formatDate = (dateString: string) => {\r\n    if (!dateString || dateString === \"Unknown\") return \"Unknown\";\r\n    const date = new Date(dateString);\r\n    if (isNaN(date.getTime())) return \"Unknown\";\r\n\r\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n    const day = date.getDate().toString().padStart(2, \"0\");\r\n    const year = date.getFullYear().toString().slice(-2);\r\n\r\n    return `${month}/${day}/${year}`;\r\n  };\r\n\r\n  // Redirect to login if not authenticated\r\n  useEffect(() => {\r\n    if (status === \"unauthenticated\") {\r\n      router.push(\"/login\");\r\n    }\r\n  }, [status, router]);\r\n\r\n  // Fetch data when session is available\r\n  useEffect(() => {\r\n    if (status === \"authenticated\" && session?.user?.id) {\r\n      fetchPaymentMethods(session.user.id);\r\n      fetchLatestSubscription(session.user.id);\r\n      fetchRemainingMinutes(session.user.id);\r\n      fetchProfileImage(session.user.id);\r\n    }\r\n  }, [status, session]);\r\n\r\n  const fetchLatestSubscription = async (userId: string) => {\r\n    setLoadingSubscription(true);\r\n    try {\r\n      const response = await fetch(\r\n        `/api/subscriptions/latest?userId=${userId}`\r\n      );\r\n      const data = await response.json();\r\n\r\n      if (response.ok && data.subscription) {\r\n        setLatestSubscription(data.subscription);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching latest subscription:\", error);\r\n    } finally {\r\n      setLoadingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const fetchRemainingMinutes = async (userId: string) => {\r\n    setLoadingSubscription(true);\r\n    try {\r\n      const response = await fetch(`/api/users/${userId}`);\r\n      const data = await response.json();\r\n\r\n      if (response.ok && data.total_time !== undefined) {\r\n        setRemainingMinutes(data.total_time);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching remaining minutes:\", error);\r\n    } finally {\r\n      setLoadingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const fetchProfileImage = async (userId: string) => {\r\n    setLoadingSubscription(true);\r\n    try {\r\n      const response = await fetch(`/api/users/${userId}`);\r\n      const data = await response.json();\r\n\r\n      if (response.ok && data.profileImage) {\r\n        setProfileImage(data.profileImage);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching profile image:\", error);\r\n    } finally {\r\n      setLoadingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    await signOut({ callbackUrl: \"/\" });\r\n  };\r\n\r\n  const fetchPaymentMethods = async (userId: string) => {\r\n    if (!userId) return;\r\n\r\n    setLoadingPaymentMethods(true);\r\n    try {\r\n      const response = await fetch(\"/api/payments/get-payment-methods\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ userId }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.paymentMethods) {\r\n        setPaymentMethods(data.paymentMethods);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch payment methods:\", error);\r\n    } finally {\r\n      setLoadingPaymentMethods(false);\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (\r\n    event: React.ChangeEvent<HTMLInputElement>\r\n  ) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file || !session?.user?.id) return;\r\n\r\n    setUploadingImage(true);\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"image\", file);\r\n      formData.append(\"userId\", session.user.id);\r\n\r\n      const response = await fetch(\"/api/profile/upload-image\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (response.ok) {\r\n        setProfileImage(data.imageUrl);\r\n        // Optionally refresh the page to get updated session\r\n        router.refresh();\r\n      } else {\r\n        console.error(\"Failed to upload image:\", data.error);\r\n        alert(\"Failed to upload image. Please try again.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error uploading image:\", error);\r\n      alert(\"Error uploading image. Please try again.\");\r\n    } finally {\r\n      setUploadingImage(false);\r\n    }\r\n  };\r\n\r\n  const updateRenewalSetting = async (renew: boolean) => {\r\n    if (!session?.user?.id) return;\r\n\r\n    setUpdatingRenewal(true);\r\n    try {\r\n      const response = await fetch(\"/api/update-renewal\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          userId: session.user.id,\r\n          renew: renew,\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        // Refresh to get updated session data\r\n        router.refresh();\r\n      } else {\r\n        console.error(\"Failed to update renewal setting\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating renewal setting:\", error);\r\n    } finally {\r\n      setUpdatingRenewal(false);\r\n    }\r\n  };\r\n\r\n  const openModal = (plan: \"basic\" | \"premium\" | \"professional\") => {\r\n    setSelectedPlan(plan);\r\n    setIsModalOpen(true);\r\n  };\r\n  const onPaymentSuccess = () => {\r\n    setIsModalOpen(false);\r\n    router.refresh();\r\n  };\r\n\r\n  // Show loading state while checking authentication\r\n  if (status === \"loading\") {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-[#B57DFF]/20 via-white to-[#B57DFF]/20 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-[#B57DFF] mx-auto mb-4\"></div>\r\n          <p className=\"text-lg text-slate-600\">Loading your profile...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Don't render if not authenticated (will redirect)\r\n  if (status === \"unauthenticated\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#B57DFF]/20 via-white to-[#B57DFF]/20\">\r\n      {/* Hero Section */}\r\n      <section className=\"relative overflow-hidden bg-gradient-to-r from-[#B57DFF] to-[#B57DFF]\">\r\n        <div className=\"absolute inset-0 bg-[url('/lady.png')] bg-no-repeat bg-bottom-right bg-auto lg:bg-contain\" />\r\n        <div className=\"absolute inset-0 bg-black/20\" />\r\n        <ChatMenu />\r\n\r\n        {/* Back Button */}\r\n        {/* <div className=\"absolute top-6 left-6 z-50\">\r\n          <Link\r\n            href=\"/\"\r\n            className=\"group flex items-center space-x-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-xl px-4 py-3 text-white hover:bg-white/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl\"\r\n          >\r\n            <div className=\"p-2 rounded-lg bg-white/20 group-hover:bg-white/30 transition-all duration-300 group-hover:rotate-12\">\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n              </svg>\r\n            </div>\r\n            <span className=\"text-sm font-semibold tracking-wide\">Back to Home</span>\r\n          </Link>\r\n        </div> */}\r\n\r\n        <div className=\"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24\">\r\n          <div className=\"text-center\">\r\n            {/* Avatar */}\r\n            <div className=\"relative inline-block mb-8\">\r\n              <div className=\"w-32 h-32 rounded-full bg-white/20 backdrop-blur-xl border-4 border-white/30 flex items-center justify-center text-6xl font-bold text-white shadow-2xl overflow-hidden\">\r\n                {profileImage ? (\r\n                  <img\r\n                    src={profileImage}\r\n                    alt={`${session?.user?.name || \"User\"}'s profile`}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : session?.user?.name ? (\r\n                  session.user.name.charAt(0).toUpperCase()\r\n                ) : (\r\n                  \"U\"\r\n                )}\r\n              </div>\r\n              <div className=\"absolute -bottom-2 -right-2 w-8 h-8 rounded-full bg-white border-4 border-white shadow-lg flex items-center justify-center\">\r\n                <label className=\"cursor-pointer\">\r\n                  <svg\r\n                    className=\"w-4 h-4 text-[#B57DFF]\"\r\n                    fill=\"currentColor\"\r\n                    viewBox=\"0 0 20 20\"\r\n                  >\r\n                    <path d=\"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z\" />\r\n                  </svg>\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={handleImageUpload}\r\n                    className=\"hidden\"\r\n                    disabled={uploadingImage}\r\n                  />\r\n                </label>\r\n              </div>\r\n              {uploadingImage && (\r\n                <div className=\"absolute inset-0 w-32 h-32 rounded-full bg-black/50 flex items-center justify-center\">\r\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-white\"></div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-extrabold text-white mb-4\">\r\n              Welcome back, {session?.user?.name || \"Pet Lover\"}!\r\n            </h1>\r\n            <p className=\"text-xl text-white/90 max-w-2xl mx-auto\">\r\n              Manage your account and discover personalized pet care experiences\r\n            </p>\r\n            <div className=\"text-center flex items-center justify-center mt-6\">\r\n              <Link\r\n                href=\"/chat\"\r\n                className=\"w-[300px] flex items-center justify-center px-5 py-5  font-large text-xl text-white bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] rounded-lg shadow hover:from-[#ff5a2b] hover:to-[#B57DFF] transition-all duration-200 transform hover:scale-105\"\r\n              >\r\n                <BsChat className=\"w-6 h-6 mr-2\" />\r\n                Chat with Your AI Vet\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"absolute -bottom-8 left-0 right-0 h-16 bg-gradient-to-b from-transparent to-white\" />\r\n      </section>\r\n\r\n      {/* Main Content */}\r\n      <section className=\"relative -mt-16 pb-16\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n            {/* Profile Info */}\r\n            <div className=\"lg:col-span-2 space-y-8\">\r\n              <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow overflow-hidden\">\r\n                <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                <div className=\"p-8\">\r\n                  <h2 className=\"text-2xl font-bold text-slate-900 mb-6\">\r\n                    Account Information\r\n                  </h2>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-slate-600\">\r\n                        Full Name\r\n                      </label>\r\n                      <div className=\"text-lg font-semibold text-slate-900 bg-slate-50 rounded-lg px-4 py-3 border border-slate-200\">\r\n                        {session?.user?.name || \"Not set\"}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-slate-600\">\r\n                        Email Address\r\n                      </label>\r\n                      <div className=\"text-lg font-semibold text-slate-900 bg-slate-50 rounded-lg px-4 py-3 border border-slate-200\">\r\n                        {session?.user?.email || \"Not set\"}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2 md:col-span-2\">\r\n                      <label className=\"text-sm font-medium text-slate-600\">\r\n                        Member Since\r\n                      </label>\r\n                      <div className=\"text-lg font-semibold text-slate-900 bg-slate-50 rounded-lg px-4 py-3 border border-slate-200\">\r\n                        {formatDate(new Date().toISOString())}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Payment Methods Section */}\r\n              <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow overflow-hidden\">\r\n                <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                <div className=\"p-8\">\r\n                  <h2 className=\"text-2xl font-bold text-slate-900 mb-6\">\r\n                    Payment Methods\r\n                  </h2>\r\n\r\n                  {loadingPaymentMethods ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500\"></div>\r\n                      <span className=\"ml-3 text-slate-600\">\r\n                        Loading payment methods...\r\n                      </span>\r\n                    </div>\r\n                  ) : paymentMethods.length > 0 ? (\r\n                    <div className=\"space-y-4\">\r\n                      {paymentMethods.map((pm) => (\r\n                        <div\r\n                          key={pm.id}\r\n                          className=\"flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200\"\r\n                        >\r\n                          <div className=\"flex items-center space-x-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                              <BsCreditCard className=\"w-5 h-5 text-[#B57DFF]\" />\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"font-medium text-slate-900 capitalize\">\r\n                                {pm.card.brand} ending in {pm.card.last4}\r\n                              </p>\r\n                              <p className=\"text-sm text-slate-600\">\r\n                                Expires {pm.card.exp_month}/{pm.card.exp_year}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center\">\r\n                            <BsCheckCircle className=\"w-5 h-5 text-green-500\" />\r\n                            <span className=\"ml-2 text-sm font-medium text-green-600\">\r\n                              Default\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"text-center py-8\">\r\n                      <BsCreditCard className=\"w-12 h-12 text-slate-400 mx-auto mb-4\" />\r\n                      <p className=\"text-slate-600 mb-2\">\r\n                        No payment methods found\r\n                      </p>\r\n                      <p className=\"text-sm text-slate-500\">\r\n                        Payment methods will appear here after making a purchase\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Sidebar */}\r\n            <div className=\"space-y-8\">\r\n              {/* Stats */}\r\n              <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow overflow-hidden\">\r\n                <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                <div className=\"p-6\">\r\n                  <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">\r\n                    Account Stats\r\n                  </h3>\r\n\r\n                  <div className=\"space-y-4\">\r\n                    {/* <div className=\"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                          <svg className=\"w-5 h-5 text-[#B57DFF]\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\r\n                          </svg>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm font-medium text-slate-900\">Profile Complete</p>\r\n                          <p className=\"text-xs text-slate-600\">100%</p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                          <svg className=\"w-5 h-5 text-[#B57DFF]\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path fillRule=\"evenodd\" d=\"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z\" clipRule=\"evenodd\" />\r\n                          </svg>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm font-medium text-slate-900\">Member Since</p>\r\n                          <p className=\"text-xs text-slate-600\">{formatDate(parsedUserData?.createdAt) || \"Unknown\"}</p>\r\n                        </div>\r\n                      </div>\r\n                    </div> */}\r\n                    <div className=\"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                          <svg\r\n                            className=\"w-5 h-5 text-[#B57DFF]\"\r\n                            fill=\"currentColor\"\r\n                            viewBox=\"0 0 20 20\"\r\n                          >\r\n                            <path\r\n                              fillRule=\"evenodd\"\r\n                              d=\"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z\"\r\n                              clipRule=\"evenodd\"\r\n                            />\r\n                          </svg>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm font-medium text-slate-900\">\r\n                            Remaining Minutes\r\n                          </p>\r\n                          <p className=\"text-xs text-slate-600\">\r\n                            {remainingMinutes || \"0\"} minutes\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <Link\r\n                      href=\"/transections\"\r\n                      className=\"w-full flex items-center justify-center px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] rounded-lg shadow hover:from-[#ff5a2b] hover:to-[#B57DFF] transition-all duration-200 transform hover:scale-105\"\r\n                    >\r\n                      <BsPlus className=\"w-4 h-4 mr-2\" />\r\n                      Add More Minutes\r\n                    </Link>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Subscription Settings */}\r\n              <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow overflow-hidden\">\r\n                <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                <div className=\"p-6\">\r\n                  <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">\r\n                    Subscription Details\r\n                  </h3>\r\n\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100 m-0\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                          <svg\r\n                            className=\"w-5 h-5 text-[#B57DFF]\"\r\n                            fill=\"none\"\r\n                            stroke=\"currentColor\"\r\n                            viewBox=\"0 0 24 24\"\r\n                          >\r\n                            <path\r\n                              strokeLinecap=\"round\"\r\n                              strokeLinejoin=\"round\"\r\n                              strokeWidth={2}\r\n                              d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\r\n                            />\r\n                          </svg>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm font-medium text-slate-900\">\r\n                            Monthly Renewal\r\n                          </p>\r\n                          <p className=\"text-xs text-slate-600\">\r\n                            {session?.user?.renew !== false\r\n                              ? \"Automatically renew subscription\"\r\n                              : \"Manual renewal only\"}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <button\r\n                          onClick={() =>\r\n                            updateRenewalSetting(!session?.user?.renew)\r\n                          }\r\n                          disabled={updatingRenewal}\r\n                          className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${\r\n                            session?.user?.renew !== false\r\n                              ? \"bg-purple-500\"\r\n                              : \"bg-gray-200\"\r\n                          } ${\r\n                            updatingRenewal\r\n                              ? \"opacity-50 cursor-not-allowed\"\r\n                              : \"cursor-pointer\"\r\n                          }`}\r\n                        >\r\n                          <span\r\n                            className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\r\n                              session?.user?.renew !== false\r\n                                ? \"translate-x-6\"\r\n                                : \"translate-x-1\"\r\n                            }`}\r\n                          />\r\n                        </button>\r\n                        {updatingRenewal && (\r\n                          <div className=\"ml-2 animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500\"></div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {latestSubscription && (\r\n                      <div className=\"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100\">\r\n                        <div className=\"flex items-center space-x-3\">\r\n                          <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                            <svg\r\n                              className=\"w-5 h-5 text-[#B57DFF]\"\r\n                              fill=\"none\"\r\n                              stroke=\"currentColor\"\r\n                              viewBox=\"0 0 24 24\"\r\n                            >\r\n                              <path\r\n                                strokeLinecap=\"round\"\r\n                                strokeLinejoin=\"round\"\r\n                                strokeWidth={2}\r\n                                d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n                              />\r\n                            </svg>\r\n                          </div>\r\n                          <div>\r\n                            <p className=\"text-sm font-medium text-slate-900\">\r\n                              {latestSubscription.plan === \"basic\"\r\n                                ? \"Basic Plan\"\r\n                                : \"Premium Plan\"}\r\n                            </p>\r\n                            <p className=\"text-xs text-slate-600\">\r\n                              {formatDate(latestSubscription.createdAt)}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <p className=\"text-sm font-medium text-slate-900\">\r\n                            ${(latestSubscription.amount / 100).toFixed(2)}\r\n                            <br />\r\n                            <p className=\"text-xs text-slate-600\">\r\n                              {latestSubscription.plan === \"basic\"\r\n                                ? \"30 Minutes Talk Time\"\r\n                                : \"90 Minutes Talk Time\"}\r\n                            </p>\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              {latestSubscription && latestSubscription.plan === \"basic\" && (\r\n                <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow overflow-hidden\">\r\n                  <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                  <div className=\"p-6\">\r\n                    <h3 className=\"text-2xl font-semibold text-slate-900 mb-4\">\r\n                      Upgrade Your Account\r\n                    </h3>\r\n                    <div>\r\n                      <p className=\"text-lg font-bold text-slate-900 mb-2\">\r\n                        Premium Plan\r\n                      </p>\r\n                      <p className=\"text-md text-slate-600 \">\r\n                        $0.22 cents per minute\r\n                      </p>\r\n                      <p className=\"text-md text-slate-600\">\r\n                        90 Minutes Talk Time\r\n                      </p>\r\n                      <button\r\n                        className=\"w-full mt-2 flex items-center justify-center px-4 py-3 text-lg font-medium text-white bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] rounded-lg shadow hover:from-[#ff5a2b] hover:to-[#B57DFF] transition-all duration-200 transform hover:scale-105 cursor-pointer\"\r\n                        onClick={() => openModal(\"premium\")}\r\n                      >\r\n                        Upgrade Now\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Account Actions */}\r\n              <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow overflow-hidden\">\r\n                <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                <div className=\"p-6\">\r\n                  <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">\r\n                    Account Actions\r\n                  </h3>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    {latestSubscription ? (\r\n                      // If latestSubscription is truthy (your original 'if' block)\r\n                      <Link\r\n                        href=\"/transactions\"\r\n                        className=\"w-full flex items-center justify-center px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] rounded-lg shadow hover:from-[#ff5a2b] hover:to-[#B57DFF] transition-all duration-200 transform hover:scale-105\"\r\n                      >\r\n                        <BsCreditCard className=\"w-4 h-4 mr-2\" />\r\n                        View Transactions\r\n                      </Link>\r\n                    ) : (\r\n                      // If latestSubscription is falsy (your 'else' block)\r\n                      <Link\r\n                        href=\"/#plans\"\r\n                        className=\"w-full flex items-center justify-center px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-[#B57DFF] to-[#B57DFF] rounded-lg shadow hover:from-[#ff5a2b] hover:to-[#B57DFF] transition-all duration-200 transform hover:scale-105\"\r\n                      >\r\n                        <BsCreditCard className=\"w-4 h-4 mr-2\" />\r\n                        Buy a Plan Now\r\n                      </Link>\r\n                    )}\r\n                    {/* <form action=\"/api/auth/logout\" method=\"post\" className=\"w-full\"> */}\r\n                    <button\r\n                      onClick={logout}\r\n                      className=\"w-full flex items-center justify-center px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-red-500 to-red-600 rounded-lg shadow hover:from-red-600 hover:to-red-700 transition-all duration-200 transform hover:scale-105\"\r\n                    >\r\n                      <svg\r\n                        className=\"w-4 h-4 mr-2\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                        />\r\n                      </svg>\r\n                      Sign Out\r\n                    </button>\r\n                    {/* </form> */}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n      <PaymentModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        plan={selectedPlan}\r\n        userId={session?.user?.id || \"\"}\r\n        onPaymentSuccess={onPaymentSuccess}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\register\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\app\\transactions\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTransactions'. Either include it or remove the dependency array.","line":101,"column":6,"nodeType":"ArrayExpression","endLine":101,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [status, session?.user?.id, fetchTransactions]","fix":{"range":[2793,2820],"text":"[status, session?.user?.id, fetchTransactions]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":188,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6947,7080],"text":"\r\n                  You haven&apos;t made any payments yet. Start by subscribing to one\r\n                  of our plans!\r\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6947,7080],"text":"\r\n                  You haven&lsquo;t made any payments yet. Start by subscribing to one\r\n                  of our plans!\r\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6947,7080],"text":"\r\n                  You haven&#39;t made any payments yet. Start by subscribing to one\r\n                  of our plans!\r\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6947,7080],"text":"\r\n                  You haven&rsquo;t made any payments yet. Start by subscribing to one\r\n                  of our plans!\r\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport Link from \"next/link\";\r\nimport {\r\n  BsArrowLeft,\r\n  BsCreditCard,\r\n  BsCheckCircle,\r\n  BsXCircle,\r\n  BsClock,\r\n} from \"react-icons/bs\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useSession } from \"next-auth/react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport ChatMenu from \"../components/chat/ChatMenu\";\r\nimport Packages from \"../components/payment/Packages\";\r\n\r\ninterface Transaction {\r\n  _id: string;\r\n  plan: string;\r\n  amount: number;\r\n  currency: string;\r\n  status: \"pending\" | \"completed\" | \"failed\";\r\n  cardLast4?: string;\r\n  cardBrand?: string;\r\n  createdAt: string;\r\n  stripePaymentIntentId: string;\r\n}\r\n\r\nconst getStatusIcon = (status: string) => {\r\n  switch (status) {\r\n    case \"completed\":\r\n      return <BsCheckCircle className=\"w-5 h-5 text-green-600\" />;\r\n    case \"failed\":\r\n      return <BsXCircle className=\"w-5 h-5 text-red-600\" />;\r\n    default:\r\n      return <BsClock className=\"w-5 h-5 text-yellow-600\" />;\r\n  }\r\n};\r\n\r\nconst getStatusColor = (status: string) => {\r\n  switch (status) {\r\n    case \"completed\":\r\n      return \"bg-green-100 text-green-800\";\r\n    case \"failed\":\r\n      return \"bg-red-100 text-red-800\";\r\n    default:\r\n      return \"bg-yellow-100 text-yellow-800\";\r\n  }\r\n};\r\n\r\nconst formatAmount = (amount: number, currency: string) => {\r\n  return new Intl.NumberFormat(\"en-US\", {\r\n    style: \"currency\",\r\n    currency: currency.toUpperCase(),\r\n  }).format(amount / 100);\r\n};\r\n\r\nexport default function TransactionsPage() {\r\n  const { data: session, status } = useSession();\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  // Redirect to login if not authenticated\r\n  useEffect(() => {\r\n    if (status === \"unauthenticated\") {\r\n      router.push(\"/login\");\r\n    }\r\n  }, [status, router]);\r\n\r\n  // Function to fetch transactions\r\n  const fetchTransactions = async () => {\r\n    if (!session?.user?.id) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch(\"/api/transactions\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ userId: session.user.id }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (response.ok && data.transactions) {\r\n        setTransactions(data.transactions);\r\n      } else {\r\n        console.error(\"Failed to fetch transactions:\", data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching transactions:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Fetch transactions when session is available\r\n  useEffect(() => {\r\n    if (status === \"authenticated\" && session?.user?.id) {\r\n      fetchTransactions();\r\n    }\r\n  }, [status, session?.user?.id]);\r\n\r\n  // Show loading state while checking authentication\r\n  if (status === \"loading\") {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-orange-50 via-white to-orange-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-[#B57DFF] mx-auto mb-4\"></div>\r\n          <p className=\"text-lg text-slate-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Don't render if not authenticated (will redirect)\r\n  if (status === \"unauthenticated\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-orange-50 via-white to-orange-50\">\r\n      {/* Header */}\r\n      <ChatMenu />\r\n      <section className=\"relative overflow-hidden bg-gradient-to-r from-[#B57DFF] to-[#B57DFF]\">\r\n        <div className=\"absolute inset-0 bg-black/20\" />\r\n\r\n        {/* Back Button */}\r\n        <div className=\"absolute top-6 left-6 z-50\">\r\n          <Link\r\n            href=\"/profile\"\r\n            className=\"group flex items-center space-x-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-xl px-4 py-3 text-white hover:bg-white/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl\"\r\n          >\r\n            <div className=\"p-2 rounded-lg bg-white/20 group-hover:bg-white/30 transition-all duration-300 group-hover:rotate-12\">\r\n              <BsArrowLeft className=\"w-5 h-5\" />\r\n            </div>\r\n            <span className=\"text-sm font-semibold tracking-wide\">\r\n              Back to Profile\r\n            </span>\r\n          </Link>\r\n        </div>\r\n\r\n        <div className=\"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24\">\r\n          <div className=\"text-center\">\r\n            <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-extrabold text-white mb-4\">\r\n              Transaction History\r\n            </h1>\r\n            <p className=\"text-xl text-white/90 max-w-2xl mx-auto\">\r\n              View all your payment transactions and subscription history\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"absolute -bottom-8 left-0 right-0 h-16 bg-gradient-to-b from-transparent to-white\" />\r\n      </section>\r\n\r\n      {/* Main Content */}\r\n      <section className=\"relative -mt-16 pb-16\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          {/* Minutes Purchase Section */}\r\n          <Packages\r\n            userId={session?.user?.id || \"\"}\r\n            currentMinutes={session?.user?.total_time || 0}\r\n            onPaymentSuccess={() => {\r\n              fetchTransactions();\r\n              router.refresh(); // Refresh session data\r\n            }}\r\n          />\r\n\r\n          {loading ? (\r\n            <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow-[0_10px_40px_rgba(0,0,0,0.08)] overflow-hidden\">\r\n              <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n              <div className=\"p-12 text-center\">\r\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto\"></div>\r\n                <p className=\"mt-2 text-gray-600\">Loading transactions...</p>\r\n              </div>\r\n            </div>\r\n          ) : transactions.length === 0 ? (\r\n            <div className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow-[0_10px_40px_rgba(0,0,0,0.08)] overflow-hidden\">\r\n              <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n              <div className=\"p-12 text-center\">\r\n                <div className=\"w-16 h-16 mx-auto mb-4 bg-purple-100 rounded-full flex items-center justify-center\">\r\n                  <BsCreditCard className=\"w-8 h-8 text-[#B57DFF]\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold text-slate-900 mb-2\">\r\n                  No Transactions Yet\r\n                </h3>\r\n                <p className=\"text-slate-600 mb-6\">\r\n                  You haven't made any payments yet. Start by subscribing to one\r\n                  of our plans!\r\n                </p>\r\n                <Link\r\n                  href=\"/#plans\"\r\n                  className=\"inline-flex items-center justify-center px-6 py-3 text-white font-semibold bg-gradient-to-r from-[#B57DFF] to-[#ff8a1e] rounded-lg shadow hover:from-[#ff5a2b] hover:to-[#B57DFF] transition-all hover:scale-105\"\r\n                >\r\n                  Browse Plans\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-6\">\r\n              {transactions.map((transaction: Transaction) => (\r\n                <div\r\n                  key={transaction._id}\r\n                  className=\"relative rounded-2xl border border-white/30 bg-white/10 backdrop-blur-xl shadow-[0_10px_40px_rgba(0,0,0,0.08)] overflow-hidden\"\r\n                >\r\n                  <div className=\"absolute inset-x-0 -top-px h-px bg-gradient-to-r from-orange-400/40 via-orange-600/70 to-orange-400/40\" />\r\n                  <div className=\"p-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-4\">\r\n                        <div className=\"w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                          <BsCreditCard className=\"w-6 h-6 text-[#B57DFF]\" />\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"text-lg font-semibold text-slate-900 capitalize\">\r\n                            {transaction.plan} Plan\r\n                          </h3>\r\n                          <p className=\"text-sm text-slate-600\">\r\n                            {new Date(transaction.createdAt).toLocaleDateString(\r\n                              \"en-US\",\r\n                              {\r\n                                year: \"numeric\",\r\n                                month: \"long\",\r\n                                day: \"numeric\",\r\n                                hour: \"2-digit\",\r\n                                minute: \"2-digit\",\r\n                              }\r\n                            )}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        {(transaction.cardLast4 || transaction.cardBrand) && (\r\n                          <div className=\"\">\r\n                            <div className=\"flex items-center justify-between gap-5 text-md\">\r\n                              <span>\r\n                                {transaction.cardBrand && (\r\n                                  <span className=\"capitalize mr-2\">\r\n                                    {transaction.cardBrand}\r\n                                  </span>\r\n                                )}\r\n                                {transaction.cardLast4 && (\r\n                                  <span> {transaction.cardLast4}</span>\r\n                                )}\r\n                              </span>\r\n                              <span className=\"font-mono text-xs\">\r\n                                ID:{\" \"}\r\n                                {transaction.stripePaymentIntentId.slice(-8)}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      <div className=\"text-right\">\r\n                        <div className=\"text-2xl font-bold text-slate-900\">\r\n                          {formatAmount(\r\n                            transaction.amount,\r\n                            transaction.currency\r\n                          )}\r\n                        </div>\r\n                        <div\r\n                          className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(\r\n                            transaction.status\r\n                          )}`}\r\n                        >\r\n                          {getStatusIcon(transaction.status)}\r\n                          <span className=\"ml-2 capitalize\">\r\n                            {transaction.status}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1665,1668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1665,1668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import NextAuth, { NextAuthConfig } from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport { connectToDatabase } from \"./mongoose\";\r\nimport User from \"@/models/Users\";\r\n\r\nexport const authConfig: NextAuthConfig = {\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: \"Credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"email\" },\r\n        password: { label: \"Password\", type: \"password\" },\r\n      },\r\n      async authorize(credentials) {\r\n        if (!credentials?.email || !credentials?.password) {\r\n          throw new Error(\"Email and password are required\");\r\n        }\r\n\r\n        try {\r\n          await connectToDatabase();\r\n          \r\n          const user = await User.findOne({ \r\n            email: (credentials.email as string).toLowerCase() \r\n          });\r\n\r\n          if (!user) {\r\n            throw new Error(\"No user found with this email\");\r\n          }\r\n\r\n          const isPasswordValid = await bcrypt.compare(\r\n            credentials.password as string,\r\n            user.password\r\n          );\r\n\r\n          if (!isPasswordValid) {\r\n            throw new Error(\"Invalid password\");\r\n          }\r\n\r\n          return {\r\n            id: user._id.toString(),\r\n            email: user.email,\r\n            name: user.name,\r\n            total_time: user.total_time,\r\n            profileImage: user.profileImage,\r\n            stripeCustomerId: user.stripeCustomerId,\r\n            renew: user.renew,\r\n            subscription_date: user.subscription_date,\r\n            subscription_amount: user.subscription_amount,\r\n          };\r\n        } catch (error: any) {\r\n          console.error(\"Auth error:\", error);\r\n          throw new Error(error.message || \"Authentication failed\");\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user && user.id) {\r\n        token.id = user.id;\r\n        token.email = user.email;\r\n        token.name = user.name;\r\n        token.total_time = user.total_time;\r\n        token.profileImage = user.profileImage;\r\n        token.stripeCustomerId = user.stripeCustomerId;\r\n        token.renew = user.renew;\r\n        token.subscription_date = user.subscription_date;\r\n        token.subscription_amount = user.subscription_amount;\r\n      }\r\n      return token;\r\n    },\r\n    async session({ session, token }) {\r\n      if (token && session.user) {\r\n        session.user.id = token.id;\r\n        session.user.email = token.email as string;\r\n        session.user.name = token.name as string;\r\n        session.user.total_time = token.total_time;\r\n        session.user.profileImage = token.profileImage;\r\n        session.user.stripeCustomerId = token.stripeCustomerId;\r\n        session.user.renew = token.renew;\r\n        session.user.subscription_date = token.subscription_date;\r\n        session.user.subscription_amount = token.subscription_amount;\r\n      }\r\n      return session;\r\n    },\r\n  },\r\n  pages: {\r\n    signIn: \"/login\",\r\n  },\r\n  session: {\r\n    strategy: \"jwt\",\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth(authConfig);\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\lib\\mongoose.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[294,297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[294,297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[428,431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[428,431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI as string;\r\n\r\nif (!MONGODB_URI) {\r\n  // We avoid throwing to keep build from crashing; routes will return clear error.\r\n  console.warn(\"MONGODB_URI is not set. Set it in .env.local\");\r\n}\r\n\r\nlet cached = (global as any).mongoose as { conn: typeof mongoose | null; promise: Promise<typeof mongoose> | null };\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    console.log(\"Using cached database connection\");\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    if (!MONGODB_URI) throw new Error(\"Missing MONGODB_URI env var\");\r\n    console.log(\"Connecting to database:\", MONGODB_URI.replace(/\\/\\/.*@/, \"//***:***@\"));\r\n    cached.promise = mongoose\r\n      .connect(MONGODB_URI)\r\n      .then((m: typeof mongoose) => {\r\n        console.log(\"Database connected successfully\");\r\n        return m;\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Database connection failed:\", err);\r\n        throw err;\r\n      });\r\n  }\r\n\r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\lib\\session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\models\\Chat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\models\\MinutePackage.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mongoose' is defined but never used.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose, { Schema, Document, models, model } from \"mongoose\";\r\n\r\nexport interface IMinutePackage extends Document {\r\n  minutes: number;\r\n  price: number; // cents\r\n  description: string;\r\n  isPopular: boolean;\r\n  isActive: boolean;\r\n}\r\n\r\nconst MinutePackageSchema = new Schema<IMinutePackage>(\r\n  {\r\n    minutes: { type: Number, required: true },\r\n    price: { type: Number, required: true },\r\n    description: { type: String },\r\n    isPopular: { type: Boolean, default: false },\r\n    isActive: { type: Boolean, default: true },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nconst MinutePackage = models?.MinutePackage || model<IMinutePackage>(\"MinutePackage\", MinutePackageSchema);\r\nexport default MinutePackage;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\models\\Plan.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mongoose' is defined but never used.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose, { Schema, Document, models, model } from \"mongoose\";\r\n\r\nexport interface IPlan extends Document {\r\n  name: string;\r\n  price: number; // cents\r\n  interval: \"month\" | \"year\";\r\n  description: string;\r\n  features: string[];\r\n  minutes: number;\r\n  isPopular: boolean;\r\n  isActive: boolean;\r\n}\r\n\r\nconst PlanSchema = new Schema<IPlan>(\r\n  {\r\n    name: { type: String, required: true },\r\n    price: { type: Number, required: true },\r\n    interval: { type: String, enum: [\"month\", \"year\"], default: \"month\" },\r\n    description: { type: String },\r\n    features: [{ type: String }],\r\n    minutes: { type: Number, default: 0 },\r\n    isPopular: { type: Boolean, default: false },\r\n    isActive: { type: Boolean, default: true },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nconst Plan = models?.Plan || model<IPlan>(\"Plan\", PlanSchema);\r\nexport default Plan;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\models\\Subscription.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\models\\Transaction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\models\\Users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\next-auth.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fiver_projects\\petcare\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]